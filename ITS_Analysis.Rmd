---
title: "ITS Analysis: NO2 and COVID-19 Lockdown"
author: "Alana Schreibman"
date: "5/27/2021"
output: 
  html_document:
    toc: true
    toc_float: 
        collapsed: true
        smooth_scroll: true
    depth: 3 
    theme: cosmo
    highlight: pygments
---

```{r global options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

***

# Interrupted Time Series Analysis
```{r, eval = TRUE}
# Install packages required for the analysis (uncomment if needed)
#install.packages("lmtest") ; install.packages("Epi")
#install.packages("tsModel"); install.packages("vcd")

# load the packages
library(foreign)
library(tsModel) 
library(lmtest) 
library(Epi)
library(splines) 
library(vcd) 
library(pander)
library(dplyr)
library(ggplot2)
library(cowplot)
library(lubridate)
library(gridGraphics)
library(sjmisc)
library(sjlabelled)
library(gt)
```

## Stringency index data formatting. 
```{r, eval = TRUE}
#List of countries for analysis. 
df.top5 <- read.csv(file = 'split.df.top.urban.csv')
split.df.top5 <- df.top5 %>% split(df.top5$Super.region) 
split.df.top3 <- lapply(split.df.top5, function(x) {x %>% top_n(3, Mean_Urban_NO2)
})
df.top3 <- do.call("rbind", split.df.top3)
top3.list <- df.top3$location

stringency.df <- read.csv(url("https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_latest.csv"), na.strings = c("", "NA"), header = TRUE)
stringency.df$Date <- as.factor(stringency.df$Date) %>% as.Date(stringency.df$Date, format = "%Y%m%d") 
stringency.df.mod <- stringency.df %>% select(location = 1, RegionName, Date, C1_School.closing, C2_Workplace.closing, C3_Cancel.public.events, C4_Restrictions.on.gatherings, C5_Close.public.transport, C6_Stay.at.home.requirements, C7_Restrictions.on.internal.movement, C8_International.travel.controls, StringencyIndex)
stringency.df.mod$location[stringency.df.mod$location=="Slovak Republic"] <- "Slovakia"
stringency.df.mod$location[stringency.df.mod$location=="Czech Republic"] <- "Czechia"

#Function to find the date that each index becomes positive. 
lockdown.date.fxn <- function(country, column, n) {
  lockdown.date <- stringency.df.mod %>% filter(location == country, is.na(RegionName)) %>% subset(.[, column] != 0) %>% .[1, 3] 
  dates.df <- data.frame(lockdown.date)
  Index.type <- column[n]
  Country <- country[n]
  cbind(Country, Index.type, dates.df)
}  

countries <- rep(top3.list, each = 9)
indexnames <- colnames(stringency.df.mod) 
indexnames <- indexnames[4:12]
indexnames <- rep(indexnames, 21)

stringencyindex.df <- purrr::pmap_dfr(list(countries, indexnames), lockdown.date.fxn)
stringencyindex.df$Index.type <- as.factor(stringencyindex.df$Index.type)
stringencyindex.df[[152, 3]] <- as.Date("2020-01-23") #No Oxford index data on North Korea, only info online is international travel lockdown date: https://www.wired.com/story/truth-about-north-koreas-ultra-lockdown-covid-19/
stringencyindex.df[[39, 3]] <- as.Date("2020-02-28") #Changed 02-29 date to 02-28 to avoid leap year problems. 
stringencyindex.df[[49, 3]] <- NA #Removed value for Japan restrictions on gatherings because date was in 2021 (outside of study period).
stringencyindex.df[[50, 3]] <- NA #Removed value for Japan closing public transport because date was in late 2020 (outside of study period).
stringencyindex.df[[41, 3]] <- NA #Removed value for Germany closing public transport because date was late 2020 (outside of study period).
stringencyindex.df[[158, 3]] <- NA #Removed value for Malaysia closing public transport because date was late 2020 (outside of study period).
stringencyindex.df.complete <- na.omit(stringencyindex.df) #Omits North Korea missing values, as well as South Korea, Japan, and Germany missing values. 
stringencyindex.split.df <- stringencyindex.df.complete %>% split(stringencyindex.df.complete$Index.type) #Splits data frame by index type. 
stringencyindex.df.complete$Country <- factor(stringencyindex.df.complete$Country, levels = unique(stringencyindex.df.complete$Country)) 
stringencyindex.split.country.df <- stringencyindex.df.complete %>% split(stringencyindex.df.complete$Country) #Splits data frame by country. 
```


## ITS Descriptive Plots
### ITS plotting general function. 
```{r, eval = TRUE}
NO2.df.filter.fxn <- function(location, type, date.type) {
  weekly.df <- read.csv(file = paste0("time_series_csv/", location, ".", type, ".weekly.NO2.", date.type, ".csv")) 
  weekly.df$Date <- as.Date(weekly.df$Date)
  weekly.df$Period <- as.factor(weekly.df$Period)
  weekly.df
}

ITS.plot.fxn <- function(df, index.title, location, date.start, date.lockdown.start, date.end) {
  ggplot(df, aes(x = Date, y = NO2_Concentration, group = Period, color = Period)) +
  geom_line(size = 0.75) + 
  theme_bw() +
  theme(legend.key.size = unit(1, 'cm'),
        plot.title = element_text(size=22, hjust = 0.5),
        legend.position="right",
        legend.title = element_text(size=11),
        legend.text = element_text(size=10),
        axis.title=element_text(size = 10),
        axis.text.y=element_text(size=10),
        axis.text.x=element_text(size=10,angle=90, hjust=1)) +
  labs(fill = "Year of Measured Pollution") +

  ggtitle(paste(location, "NO2,", index.title, "as interruption,\n", as.character(format((as.Date(date.start) %m-% years(1)), "%b %Y")), "-", as.character(format((as.Date(date.end) %m-% years(1)), "%b %Y")), "vs", as.character(format(as.Date(date.start), "%b %Y")), "-", as.character(format(as.Date(date.end), "%b %Y")))) +
  ylab("NO2 Concentration (mol/m^2)") +
  scale_x_date(date_labels = "%b",date_breaks = "1 month",expand=c(0,0),limits=c(as.Date(date.start,format="%Y-%m-%d"),as.Date(date.end,format="%Y-%m-%d"))) +
  ylim(0, 3E-4) +
  
  #Pre-lockdown
  geom_rect(data=df,aes(xmin=as.Date(date.start,format="%Y-%m-%d"),xmax=as.Date(date.lockdown.start,format="%Y-%m-%d"),ymin=2.9E-4,ymax=3E-4),fill = "#c0c0c0",color = NA, alpha=0.02) +
  geom_text(data=df,aes(x=mean.Date(as.Date(c(date.start, date.lockdown.start),format=c("%Y-%m-%d"))),y=2.95E-4),label="Pre-Lockdown", color = "black", size = 3) +
  geom_vline(data=df,xintercept = as.Date(date.lockdown.start,format="%Y-%m-%d"),linetype="dashed",colour="black",size=0.75,alpha=0.8) + 
  #Lockdown
  geom_rect(data=df,aes(xmin=as.Date(date.lockdown.start,format="%Y-%m-%d"),xmax=as.Date(date.end,format="%Y-%m-%d"),ymin=2.9E-4,ymax=3E-4),fill = "#fa9796",color = NA,alpha=0.02) +
  geom_text(data=df,aes(x=mean.Date(as.Date(c(date.lockdown.start, date.end),format=c("%Y-%m-%d"))),y=2.95E-4),label="Lockdown and Gradual Re-Opening", color = "black", size = 3) +
  scale_alpha_manual(values = c(0.4, 1.1)) + 
  scale_color_manual(values = c("gray", "blue", "black"))
}

#Helpful to define lists for later. 
file.index.list <- c("schoolclosing", "workplaceclosing", "cancelevents", "restrictgatherings", "closetransport", "stayathome", "restrictinternal", "restricttravel", "stringencyindex")
index.title.list <- c("school closures", "workplace closures", "cancelled public events", "restrictions on gatherings", "public transport closures", "stay at home orders", "restrictions on internal travel", "restrictions on international travel", "overall lockdown stringency index")
```


### ITS yearly plots by country
```{r, fig.width=10, fig.height=10, eval = TRUE}
#World 
#world.urban.year.df.list <- purrr::pmap(list("World", "urban", "whodeclaration"), NO2.df.filter.fxn)
#world.rural.year.df.list <- purrr::pmap(list("World", "rural", "whodeclaration"), NO2.df.filter.fxn)

#world.urban.year.plot <- purrr::pmap(list(world.urban.year.df.list, "WHO Declaration of Pandemic", "World urban", "2019-12-01", as.Date("2020-01-23"), "2020-12-24"), ITS.plot.fxn)
#world.rural.year.plot <- purrr::pmap(list(world.rural.year.df.list, "WHO Declaration of Pandemic", "World rural", "2019-12-01", as.Date("2020-01-23"), "2020-12-24"), ITS.plot.fxn)

#purrr::pmap(list(world.urban.year.plot, world.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
#}) #Combines country's urban and rural for each index. 

#Poland
poland.urban.year.df.list <- purrr::pmap(list("Poland", "urban", file.index.list), NO2.df.filter.fxn)
poland.rural.year.df.list <- purrr::pmap(list("Poland", "rural", file.index.list), NO2.df.filter.fxn)

poland.urban.year.plot <- purrr::pmap(list(poland.urban.year.df.list, index.title.list, "Poland urban", "2019-12-01", stringencyindex.split.country.df[[1]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
poland.rural.year.plot <- purrr::pmap(list(poland.rural.year.df.list, index.title.list, "Poland rural", "2019-12-01", stringencyindex.split.country.df[[1]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(poland.urban.year.plot, poland.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Slovakia
slovakia.urban.year.df.list <- purrr::pmap(list("Slovakia", "urban", file.index.list), NO2.df.filter.fxn)
slovakia.rural.year.df.list <- purrr::pmap(list("Slovakia", "rural", file.index.list), NO2.df.filter.fxn)

slovakia.urban.year.plot <- purrr::pmap(list(slovakia.urban.year.df.list, index.title.list, "Slovakia urban", "2019-12-01", stringencyindex.split.country.df[[2]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
slovakia.rural.year.plot <- purrr::pmap(list(slovakia.rural.year.df.list, index.title.list, "Slovakia rural", "2019-12-01", stringencyindex.split.country.df[[2]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(slovakia.urban.year.plot, slovakia.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Czechia
czechia.urban.year.df.list <- purrr::pmap(list("Czechia", "urban", file.index.list), NO2.df.filter.fxn)
czechia.rural.year.df.list <- purrr::pmap(list("Czechia", "rural", file.index.list), NO2.df.filter.fxn)

czechia.urban.year.plot <- purrr::pmap(list(czechia.urban.year.df.list, index.title.list, "Czechia urban", "2019-12-01", stringencyindex.split.country.df[[3]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
czechia.rural.year.plot <- purrr::pmap(list(czechia.rural.year.df.list, index.title.list, "Czechia rural", "2019-12-01", stringencyindex.split.country.df[[3]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(czechia.urban.year.plot, czechia.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#South Korea
skorea.urban.year.df.list <- purrr::pmap(list("South Korea", "urban", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)
skorea.rural.year.df.list <- purrr::pmap(list("South Korea", "rural", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)

skorea.urban.year.plot <- purrr::pmap(list(skorea.urban.year.df.list, index.title.list[c(1:4, 6:9)], "South Korea urban", "2019-12-01", stringencyindex.split.country.df[[4]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
skorea.rural.year.plot <- purrr::pmap(list(skorea.rural.year.df.list, index.title.list[c(1:4, 6:9)], "South Korea rural", "2019-12-01", stringencyindex.split.country.df[[4]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(skorea.urban.year.plot, skorea.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Germany
germany.urban.year.df.list <- purrr::pmap(list("Germany", "urban", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)
germany.rural.year.df.list <- purrr::pmap(list("Germany", "rural", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)

germany.urban.year.plot <- purrr::pmap(list(germany.urban.year.df.list, index.title.list[c(1:4, 6:9)], "Germany urban", "2019-12-01", stringencyindex.split.country.df[[5]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
germany.rural.year.plot <- purrr::pmap(list(germany.rural.year.df.list, index.title.list[c(1:4, 6:9)], "Germany rural", "2019-12-01", stringencyindex.split.country.df[[5]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(germany.urban.year.plot, germany.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Japan
japan.urban.year.df.list <- purrr::pmap(list("Japan", "urban", file.index.list[c(1:3, 6:9)]), NO2.df.filter.fxn)
japan.rural.year.df.list <- purrr::pmap(list("Japan", "rural", file.index.list[c(1:3, 6:9)]), NO2.df.filter.fxn)

japan.urban.year.plot <- purrr::pmap(list(japan.urban.year.df.list, index.title.list[c(1:3, 6:9)], "Japan urban", "2019-10-31", stringencyindex.split.country.df[[6]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
japan.rural.year.plot <- purrr::pmap(list(japan.rural.year.df.list, index.title.list[c(1:3, 6:9)], "Japan rural", "2019-10-31", stringencyindex.split.country.df[[6]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(japan.urban.year.plot, japan.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Panama 
panama.urban.year.df.list <- purrr::pmap(list("Panama", "urban", file.index.list), NO2.df.filter.fxn)
panama.rural.year.df.list <- purrr::pmap(list("Panama", "rural", file.index.list), NO2.df.filter.fxn)

panama.urban.year.plot <- purrr::pmap(list(panama.urban.year.df.list, index.title.list, "Panama urban", "2019-12-01", stringencyindex.split.country.df[[7]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
panama.rural.year.plot <- purrr::pmap(list(panama.rural.year.df.list, index.title.list, "Panama rural", "2019-12-01", stringencyindex.split.country.df[[7]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(panama.urban.year.plot, panama.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Guatemala 
guatemala.urban.year.df.list <- purrr::pmap(list("Guatemala", "urban", file.index.list), NO2.df.filter.fxn)
guatemala.rural.year.df.list <- purrr::pmap(list("Guatemala", "rural", file.index.list), NO2.df.filter.fxn)

guatemala.urban.year.plot <- purrr::pmap(list(guatemala.urban.year.df.list, index.title.list, "Guatemala urban", "2019-12-01", stringencyindex.split.country.df[[8]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
guatemala.rural.year.plot <- purrr::pmap(list(guatemala.rural.year.df.list, index.title.list, "Guatemala rural", "2019-12-01", stringencyindex.split.country.df[[8]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(guatemala.urban.year.plot, guatemala.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Brazil
brazil.urban.year.df.list <- purrr::pmap(list("Brazil", "urban", file.index.list), NO2.df.filter.fxn)
brazil.rural.year.df.list <- purrr::pmap(list("Brazil", "rural", file.index.list), NO2.df.filter.fxn)

brazil.urban.year.plot <- purrr::pmap(list(brazil.urban.year.df.list, index.title.list, "Brazil urban", "2019-12-01", stringencyindex.split.country.df[[9]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
brazil.rural.year.plot <- purrr::pmap(list(brazil.rural.year.df.list, index.title.list, "Brazil rural", "2019-12-01", stringencyindex.split.country.df[[9]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(brazil.urban.year.plot, brazil.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Iraq
iraq.urban.year.df.list <- purrr::pmap(list("Iraq", "urban", file.index.list), NO2.df.filter.fxn)
iraq.rural.year.df.list <- purrr::pmap(list("Iraq", "rural", file.index.list), NO2.df.filter.fxn)

iraq.urban.year.plot <- purrr::pmap(list(iraq.urban.year.df.list, index.title.list, "Iraq urban", "2019-12-01", stringencyindex.split.country.df[[10]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
iraq.rural.year.plot <- purrr::pmap(list(iraq.rural.year.df.list, index.title.list, "Iraq rural", "2019-12-01", stringencyindex.split.country.df[[10]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(iraq.urban.year.plot, iraq.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Egypt
egypt.urban.year.df.list <- purrr::pmap(list("Egypt", "urban", file.index.list), NO2.df.filter.fxn)
egypt.rural.year.df.list <- purrr::pmap(list("Egypt", "rural", file.index.list), NO2.df.filter.fxn)

egypt.urban.year.plot <- purrr::pmap(list(egypt.urban.year.df.list, index.title.list, "Egypt urban", "2019-12-01", stringencyindex.split.country.df[[11]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
egypt.rural.year.plot <- purrr::pmap(list(egypt.rural.year.df.list, index.title.list, "Egypt rural", "2019-12-01", stringencyindex.split.country.df[[11]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(egypt.urban.year.plot, egypt.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Syria
syria.urban.year.df.list <- purrr::pmap(list("Syria", "urban", file.index.list), NO2.df.filter.fxn)
syria.rural.year.df.list <- purrr::pmap(list("Syria", "rural", file.index.list), NO2.df.filter.fxn)

syria.urban.year.plot <- purrr::pmap(list(syria.urban.year.df.list, index.title.list, "Syria urban", "2019-12-01", stringencyindex.split.country.df[[12]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
syria.rural.year.plot <- purrr::pmap(list(syria.rural.year.df.list, index.title.list, "Syria rural", "2019-12-01", stringencyindex.split.country.df[[12]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(syria.urban.year.plot, syria.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#India
india.urban.year.df.list <- purrr::pmap(list("India", "urban", file.index.list), NO2.df.filter.fxn)
india.rural.year.df.list <- purrr::pmap(list("India", "rural", file.index.list), NO2.df.filter.fxn)

india.urban.year.plot <- purrr::pmap(list(india.urban.year.df.list, index.title.list, "India urban", "2019-12-01", stringencyindex.split.country.df[[13]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
india.rural.year.plot <- purrr::pmap(list(india.rural.year.df.list, index.title.list, "India rural", "2019-12-01", stringencyindex.split.country.df[[13]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(india.urban.year.plot, india.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Pakistan
pakistan.urban.year.df.list <- purrr::pmap(list("Pakistan", "urban", file.index.list), NO2.df.filter.fxn)
pakistan.rural.year.df.list <- purrr::pmap(list("Pakistan", "rural", file.index.list), NO2.df.filter.fxn)

pakistan.urban.year.plot <- purrr::pmap(list(pakistan.urban.year.df.list, index.title.list, "Pakistan urban", "2019-12-01", stringencyindex.split.country.df[[14]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
pakistan.rural.year.plot <- purrr::pmap(list(pakistan.rural.year.df.list, index.title.list, "Pakistan rural", "2019-12-01", stringencyindex.split.country.df[[14]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(pakistan.urban.year.plot, pakistan.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Bangladesh
bangladesh.urban.year.df.list <- purrr::pmap(list("Bangladesh", "urban", file.index.list), NO2.df.filter.fxn)
bangladesh.rural.year.df.list <- purrr::pmap(list("Bangladesh", "rural", file.index.list), NO2.df.filter.fxn)

bangladesh.urban.year.plot <- purrr::pmap(list(bangladesh.urban.year.df.list, index.title.list, "Bangladesh urban", "2019-12-01", stringencyindex.split.country.df[[15]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
bangladesh.rural.year.plot <- purrr::pmap(list(bangladesh.rural.year.df.list, index.title.list, "Bangladesh rural", "2019-12-01", stringencyindex.split.country.df[[15]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(bangladesh.urban.year.plot, bangladesh.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#China
china.urban.year.df.list <- purrr::pmap(list("China", "urban", file.index.list), NO2.df.filter.fxn)
china.rural.year.df.list <- purrr::pmap(list("China", "rural", file.index.list), NO2.df.filter.fxn)

china.urban.year.plot <- purrr::pmap(list(china.urban.year.df.list, index.title.list, "China urban", "2019-10-31", stringencyindex.split.country.df[[16]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
china.rural.year.plot <- purrr::pmap(list(china.rural.year.df.list, index.title.list, "China rural", "2019-10-31", stringencyindex.split.country.df[[16]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(china.urban.year.plot, china.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#North Korea
nkorea.urban.year.df.list <- purrr::pmap(list("North Korea", "urban", file.index.list[8]), NO2.df.filter.fxn)
nkorea.rural.year.df.list <- purrr::pmap(list("North Korea", "rural", file.index.list[8]), NO2.df.filter.fxn)

nkorea.urban.year.plot <- purrr::pmap(list(nkorea.urban.year.df.list, index.title.list[8], "North Korea urban", "2019-12-01", stringencyindex.split.country.df[[17]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
nkorea.rural.year.plot <- purrr::pmap(list(nkorea.rural.year.df.list, index.title.list[8], "North Korea rural", "2019-12-01", stringencyindex.split.country.df[[17]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(nkorea.urban.year.plot, nkorea.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Malaysia
malaysia.urban.year.df.list <- purrr::pmap(list("Malaysia", "urban", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)
malaysia.rural.year.df.list <- purrr::pmap(list("Malaysia", "rural", file.index.list[c(1:4, 6:9)]), NO2.df.filter.fxn)

malaysia.urban.year.plot <- purrr::pmap(list(malaysia.urban.year.df.list, index.title.list[c(1:4, 6:9)], "Malaysia urban", "2019-12-01", stringencyindex.split.country.df[[18]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
malaysia.rural.year.plot <- purrr::pmap(list(malaysia.rural.year.df.list, index.title.list[c(1:4, 6:9)], "Malaysia rural", "2019-12-01", stringencyindex.split.country.df[[18]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(malaysia.urban.year.plot, malaysia.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#South Africa
safrica.urban.year.df.list <- purrr::pmap(list("South Africa", "urban", file.index.list), NO2.df.filter.fxn)
safrica.rural.year.df.list <- purrr::pmap(list("South Africa", "rural", file.index.list), NO2.df.filter.fxn)

safrica.urban.year.plot <- purrr::pmap(list(safrica.urban.year.df.list, index.title.list, "South Africa urban", "2019-12-01", stringencyindex.split.country.df[[19]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
safrica.rural.year.plot <- purrr::pmap(list(safrica.rural.year.df.list, index.title.list, "South Africa rural", "2019-12-01", stringencyindex.split.country.df[[19]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(safrica.urban.year.plot, safrica.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Congo
congo.urban.year.df.list <- purrr::pmap(list("Congo", "urban", file.index.list), NO2.df.filter.fxn)
congo.rural.year.df.list <- purrr::pmap(list("Congo", "rural", file.index.list), NO2.df.filter.fxn)

congo.urban.year.plot <- purrr::pmap(list(congo.urban.year.df.list, index.title.list, "Congo urban", "2019-12-01", stringencyindex.split.country.df[[20]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
congo.rural.year.plot <- purrr::pmap(list(congo.rural.year.df.list, index.title.list, "Congo rural", "2019-12-01", stringencyindex.split.country.df[[20]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(congo.urban.year.plot, congo.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.

#Nigeria
nigeria.urban.year.df.list <- purrr::pmap(list("Nigeria", "urban", file.index.list), NO2.df.filter.fxn)
nigeria.rural.year.df.list <- purrr::pmap(list("Nigeria", "rural", file.index.list), NO2.df.filter.fxn)

nigeria.urban.year.plot <- purrr::pmap(list(nigeria.urban.year.df.list, index.title.list, "Nigeria urban", "2019-12-01", stringencyindex.split.country.df[[21]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)
nigeria.rural.year.plot <- purrr::pmap(list(nigeria.rural.year.df.list, index.title.list, "Nigeria rural", "2019-12-01", stringencyindex.split.country.df[[21]]$lockdown.date, "2020-12-24"), ITS.plot.fxn)

purrr::pmap(list(nigeria.urban.year.plot, nigeria.rural.year.plot), function(x,y) {plot_grid(x, y, labels = c('A', 'B'), ncol = 1) 
}) #Combines country's urban and rural for each index.
```


### DELETE LATER: old plots 
```{r, eval = FALSE, include=FALSE}
#World
world.urban.weekly.df <- NO2.df.filter.fxn("world", "urban")
world.rural.weekly.df <- NO2.df.filter.fxn("world", "rural")

world.urban.plot <- ITS.plot.fxn(world.urban.weekly.df, "World Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-01-30", "2020-07-01", "2020-12-24")
world.rural.plot <- ITS.plot.fxn(world.rural.weekly.df, "World Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-01-30", "2020-07-01", "2020-12-24")
world.rural.vs.urban <- plot_grid(world.urban.plot, world.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("World_rural_vs_urban.pdf", world.rural.vs.urban)
world.rural.vs.urban 

#Poland
poland.urban.weekly.df <- NO2.df.filter.fxn("Poland", "urban", "schoolclosing")
poland.rural.weekly.df <- NO2.df.filter.fxn("Poland", "rural", "schoolclosing")

poland.urban.plot <- ITS.plot.fxn(poland.urban.weekly.df, "Poland Urban", "2019-12-01", "2020-03-12", "2020-12-24")
poland.rural.plot <- ITS.plot.fxn(poland.rural.weekly.df, "Poland Rural", "2019-12-01", "2020-03-12", "2020-12-24")
poland.rural.vs.urban <- plot_grid(poland.urban.plot, poland.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Poland_rural_vs_urban.pdf", poland.rural.vs.urban)
poland.rural.vs.urban 

#China 
china.urban.weekly.df <- NO2.df.filter.fxn("China", "urban", "schoolclosing")
china.rural.weekly.df <- NO2.df.filter.fxn("China", "rural", "schoolclosing")

china.urban.plot <- ITS.plot.fxn(china.urban.weekly.df, "China Urban", "2019-10-13", "2020-03-12", "2020-07-01", "2020-12-24")
china.rural.plot <- ITS.plot.fxn(china.rural.weekly.df, "China Rural", "2019-10-13", "2020-03-12", "2020-07-01", "2020-12-24")
china.rural.vs.urban <- plot_grid(china.urban.plot, china.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("China_rural_vs_urban.pdf", china.rural.vs.urban)
china.rural.vs.urban 

#Czechia
czechia.urban.weekly.df <- NO2.df.filter.fxn("czechia", "urban")
czechia.rural.weekly.df <- NO2.df.filter.fxn("czechia", "rural")

czechia.urban.plot <- ITS.plot.fxn(czechia.urban.weekly.df, "Czechia Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-04-12", "2020-12-24")
czechia.rural.plot <- ITS.plot.fxn(czechia.rural.weekly.df, "Czechia Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-04-12", "2020-12-24")
czechia.rural.vs.urban <- plot_grid(czechia.urban.plot, czechia.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Czechia_rural_vs_urban.pdf", czechia.rural.vs.urban)
czechia.rural.vs.urban 

#Slovenia
slovenia.urban.weekly.df <- NO2.df.filter.fxn("slovenia", "urban")
slovenia.rural.weekly.df <- NO2.df.filter.fxn("slovenia", "rural")

slovenia.urban.plot <- ITS.plot.fxn(slovenia.urban.weekly.df, "Slovenia Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-05-15", "2020-12-24")
slovenia.rural.plot <- ITS.plot.fxn(slovenia.rural.weekly.df, "Slovenia Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-05-15", "2020-12-24")
slovenia.rural.vs.urban <- plot_grid(slovenia.urban.plot, slovenia.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Slovenia_rural_vs_urban.pdf", slovenia.rural.vs.urban)
slovenia.rural.vs.urban 

#Sweden
sweden.urban.weekly.df <- NO2.df.filter.fxn("sweden", "urban")
sweden.rural.weekly.df <- NO2.df.filter.fxn("sweden", "rural")

sweden.urban.plot <- ITS.plot.fxn(sweden.urban.weekly.df, "Sweden Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-05-15", "2020-12-24") #No real lockdown end date, use May 15 as arbitrart date. 
sweden.rural.plot <- ITS.plot.fxn(sweden.rural.weekly.df, "Sweden Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-05-15", "2020-12-24")
sweden.rural.vs.urban <- plot_grid(sweden.urban.plot, sweden.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Sweden_rural_vs_urban.pdf", sweden.rural.vs.urban)
sweden.rural.vs.urban 

#Uruguay
uruguay.urban.weekly.df <- NO2.df.filter.fxn("uruguay", "urban")
uruguay.rural.weekly.df <- NO2.df.filter.fxn("uruguay", "rural")

uruguay.urban.plot <- ITS.plot.fxn(uruguay.urban.weekly.df, "Uruguay Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-13", "2020-05-04", "2020-12-24")
uruguay.rural.plot <- ITS.plot.fxn(uruguay.rural.weekly.df, "Uruguay Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-13", "2020-05-04", "2020-12-24")
uruguay.rural.vs.urban <- plot_grid(uruguay.urban.plot, uruguay.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Uruguay_rural_vs_urban.pdf", uruguay.rural.vs.urban)
uruguay.rural.vs.urban 

#Lithuania
lithuania.urban.weekly.df <- NO2.df.filter.fxn("lithuania", "urban")
lithuania.rural.weekly.df <- NO2.df.filter.fxn("lithuania", "rural")

lithuania.urban.plot <- ITS.plot.fxn(lithuania.urban.weekly.df, "Lithuania Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-06-18", "2020-12-24")
lithuania.rural.plot <- ITS.plot.fxn(lithuania.rural.weekly.df, "Lithuania Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-16", "2020-06-18", "2020-12-24")
lithuania.rural.vs.urban <- plot_grid(lithuania.urban.plot, lithuania.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Lithuania_rural_vs_urban.pdf", lithuania.rural.vs.urban)
lithuania.rural.vs.urban 

#U.S.
us.urban.weekly.df <- NO2.df.filter.fxn("us", "urban")
us.rural.weekly.df <- NO2.df.filter.fxn("us", "rural")

us.urban.plot <- ITS.plot.fxn(us.urban.weekly.df, "U.S. Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-19", "2020-06-05", "2020-12-24")
us.rural.plot <- ITS.plot.fxn(us.rural.weekly.df, "U.S. Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-19", "2020-06-05", "2020-12-24")
us.rural.vs.urban <- plot_grid(us.urban.plot, us.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("US_rural_vs_urban.pdf", us.rural.vs.urban)
us.rural.vs.urban 

#Netherlands
netherlands.urban.weekly.df <- NO2.df.filter.fxn("netherlands", "urban")
netherlands.rural.weekly.df <- NO2.df.filter.fxn("netherlands", "rural")

netherlands.urban.plot <- ITS.plot.fxn(netherlands.urban.weekly.df, "Netherlands Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-15", "2020-04-06", "2020-12-24")
netherlands.rural.plot <- ITS.plot.fxn(netherlands.rural.weekly.df, "Netherlands Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-15", "2020-04-06", "2020-12-24")
netherlands.rural.vs.urban <- plot_grid(netherlands.urban.plot, netherlands.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Netherlands_rural_vs_urban.pdf", netherlands.rural.vs.urban)
netherlands.rural.vs.urban 

#Estonia
estonia.urban.weekly.df <- NO2.df.filter.fxn("estonia", "urban")
estonia.rural.weekly.df <- NO2.df.filter.fxn("estonia", "rural")

estonia.urban.plot <- ITS.plot.fxn(estonia.urban.weekly.df, "Estonia Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-13", "2020-05-17", "2020-12-24")
estonia.rural.plot <- ITS.plot.fxn(estonia.rural.weekly.df, "Estonia Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-13", "2020-05-17", "2020-12-24")
estonia.rural.vs.urban <- plot_grid(estonia.urban.plot, estonia.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Estonia_rural_vs_urban.pdf", estonia.rural.vs.urban)
estonia.rural.vs.urban 

#Argentina
argentina.urban.weekly.df <- NO2.df.filter.fxn("argentina", "urban")
argentina.rural.weekly.df <- NO2.df.filter.fxn("argentina", "rural")

argentina.urban.plot <- ITS.plot.fxn(argentina.urban.weekly.df, "Argentina Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020",  "2019-12-01", "2020-03-20", "2020-05-10", "2020-12-24")
argentina.rural.plot <- ITS.plot.fxn(argentina.rural.weekly.df, "Argentina Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-20", "2020-05-10", "2020-12-24")
argentina.rural.vs.urban <- plot_grid(argentina.urban.plot, argentina.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Argentina_rural_vs_urban.pdf", argentina.rural.vs.urban)
argentina.rural.vs.urban 

#Israel
israel.urban.weekly.df <- NO2.df.filter.fxn("israel", "urban")
israel.rural.weekly.df <- NO2.df.filter.fxn("israel", "rural")

israel.urban.plot <- ITS.plot.fxn(israel.urban.weekly.df, "Israel Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020",  "2019-12-01", "2020-03-20", "2020-05-10", "2020-12-24")
israel.rural.plot <- ITS.plot.fxn(israel.rural.weekly.df, "Israel Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-20", "2020-05-10", "2020-12-24")
israel.rural.vs.urban <- plot_grid(israel.urban.plot, israel.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Israel_rural_vs_urban.pdf", israel.rural.vs.urban)
israel.rural.vs.urban 

#China
china.urban.weekly.df <- NO2.df.filter.fxn("mod.china", "urban")
china.rural.weekly.df <- NO2.df.filter.fxn("mod.china", "rural")

china.urban.plot <- ITS.plot.fxn(china.urban.weekly.df, "China Urban", "Nov 2018 - Nov 2019", "Nov 2019 - Nov 2020", "2019-10-31", "2020-01-23", "2020-04-08", "2020-11-01")
china.rural.plot <- ITS.plot.fxn(china.rural.weekly.df, "China Rural", "Nov 2018 - Nov 2019", "Nov 2019 - Nov 2020", "2019-10-31", "2020-01-23", "2020-04-08", "2020-11-01")
china.rural.vs.urban <- plot_grid(china.urban.plot, china.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("China_rural_vs_urban.pdf", china.rural.vs.urban)
china.rural.vs.urban

#Italy
italy.urban.weekly.df <- NO2.df.filter.fxn("italy", "urban")
italy.rural.weekly.df <- NO2.df.filter.fxn("italy", "rural")

italy.urban.plot <- ITS.plot.fxn(italy.urban.weekly.df, "Italy Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-09", "2020-05-18", "2020-12-24")
italy.rural.plot <- ITS.plot.fxn(italy.rural.weekly.df, "Italy Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-09", "2020-05-18", "2020-12-24")
italy.rural.vs.urban <- plot_grid(italy.urban.plot, italy.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Italy_rural_vs_urban.pdf", italy.rural.vs.urban)
italy.rural.vs.urban 

#Iraq
iraq.urban.weekly.df <- NO2.df.filter.fxn("iraq", "urban")
iraq.rural.weekly.df <- NO2.df.filter.fxn("iraq", "rural")

iraq.urban.plot <- ITS.plot.fxn(iraq.urban.weekly.df, "Iraq Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-04-04", "2020-05-18", "2020-12-24") #End date is uncertain, seems to be flux of lockdown and no lockdown depending on holidays. 
iraq.rural.plot <- ITS.plot.fxn(iraq.rural.weekly.df, "Iraq Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-04-04", "2020-05-18", "2020-12-24")
iraq.rural.vs.urban <- plot_grid(iraq.urban.plot, iraq.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("Iraq_rural_vs_urban.pdf", iraq.rural.vs.urban)
iraq.rural.vs.urban 

#India
india.urban.weekly.df <- NO2.df.filter.fxn("india", "urban")
india.rural.weekly.df <- NO2.df.filter.fxn("india", "rural")

india.urban.plot <- ITS.plot.fxn(india.urban.weekly.df, "India Urban", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-24", "2020-05-31", "2020-12-24") #End date is uncertain, seems to be flux of lockdown and no lockdown depending on holidays. 
india.rural.plot <- ITS.plot.fxn(india.rural.weekly.df, "India Rural", "Dec 2018 - Dec 2019", "Dec 2019 - Dec 2020", "2019-12-01", "2020-03-24", "2020-05-31", "2020-12-24")
india.rural.vs.urban <- plot_grid(india.urban.plot, india.rural.plot, labels = c('A', 'B'), ncol = 1) 
ggsave("India_rural_vs_urban.pdf", india.rural.vs.urban)
india.rural.vs.urban 
```


## ITS Analysis
### Prepare general functions for ITS analysis. 
```{r, eval = TRUE}
col = c("#084594","#990000")

#Function to filter NO2 data and make df for plotting. 
NO2.df.filter.fxn <- function(location, type, date.type, lockdown.date) {
  weekly.df <- read.csv(file = paste0("time_series_csv/", location, ".", type, ".weekly.NO2.", date.type, ".csv")) 
  weekly.df$Date <- as.Date(weekly.df$Date)
  weekly.df$Period <- as.factor(weekly.df$Period)
  NO2.19 <-  weekly.df %>% dplyr::filter(Period == 2019) 
  NO2.20 <- weekly.df %>% dplyr::filter(Period == 2020) 
  lockdown <- as.Date(lockdown.date)
  date.list.19 <- NO2.19$Date
  date.list.20 <- NO2.20$Date
  index <- which(date.list.20 %in% lockdown)
  NO2.19 <- NO2.19[NO2.19$Date >= date.list.19[[index-12]] & NO2.19$Date <= date.list.19[[index+11]], ] %>%
    dplyr::mutate(covid_lockdown = rep(c(0,1),c(12,12)),year2020 = 0,no_of_weeks = seq(1:24))
  NO2.20 <- NO2.20[NO2.20$Date >= date.list.20[[index-12]] & NO2.20$Date <= date.list.20[[index+11]], ] %>%
    dplyr::mutate(covid_lockdown = rep(c(0,1),c(12,12)),year2020 = 1,no_of_weeks = seq(1:24))
  NO2.df <- rbind(NO2.19,NO2.20)
  NO2.df
}

#ggplot2 scatter plot for observation
scatter_gplot <- function(data,ylim,location,index.type) {
  df <- data.frame(data)
  #convert year to factor 
  df$year2020 <- as.factor(df$year2020)

  #plot
  ggplot(df, aes(y=NO2_Concentration,x=no_of_weeks,colour=year2020)) + 
    geom_point(size=2) +
    scale_color_manual(values=col) + 
    #add line to denote lockdown
    geom_vline(xintercept=12, linetype="twodash",colour="darkred",size=1.4) +
    ylim(0,ylim) +
    labs(x="Weeks", y=paste(location,"NO2 estimates in 2019 vs 2020"),colour = "Year2020") + 
    theme_bw() +
    theme(legend.title = element_text(size=9)) + 
    ggtitle(paste(location, "NO2,", index.type, "\nas interruption"))
}

#main plot
period_scatter_plot <- function(data,ylim,location,lockdown.date,index.type,model){
    datanew <- data.frame(NO2_Concentration=mean(data$NO2_Concentration),covid_lockdown=rep(c(0,1,0,1),c(120,120,120,120)), no_of_weeks=c((1:240/10), (1:240/10)), year2020 = rep(c(0,1),c(240, 240)))

  # We generate predicted values based on the model in order to create a plot
  # need to reconfirm the mean multiplier value ; using 10 for now
  pred1 <- predict(model,datanew, type="response") #/mean(data$pollution_estimate)*10

  #This can then be plotted along with a scatter graph (see above)
  #plot for 2019
  data.2019 <- data %>% filter(., year2020 == 0) %>% select(., NO2_Concentration, no_of_weeks) 

  plot(NO2_Concentration ~ no_of_weeks, data = data.2019, type="n",ylim=c(00,ylim),xlab="Date", ylab=paste0("NO2 estimates"), bty="l", xaxt="n", cex.main=0.5, cex.lab=0.6, cex.axis=0.4)
  rect(12,0,24,ylim,col=grey(0.9),border=F)
  points(NO2_Concentration ~ no_of_weeks,data = data.2019,cex=0.7,pch=16,col=alpha(col[1],0.5))
  legend("topright", inset=.05, legend=c("2019", "2020"), col=alpha(col,0.5),pch=16,cex=0.7)
  
  #plot for 2020
   data.2020 <- data %>% filter(., year2020 == 1) %>% select(., NO2_Concentration, no_of_weeks) 
  par(new=TRUE, cex.axis = 0.6)
  plot(NO2_Concentration ~ no_of_weeks,data = data.2020, type="n",ylim=c(00,ylim),xlab="Date", ylab=paste0("NO2 estimates"), bty="l", xaxt="n", cex.main=0.5, cex.lab=0.6, cex.axis=0.4)
  points(NO2_Concentration ~ no_of_weeks,data = data.2020,cex=0.7,pch=16,col=alpha(col[2],0.5))
  date.list <- data$Date %>% as.Date() %>% format("%b %d")
  date.list <- date.list[1:24]
  date.list.seq <- date.list[seq(2, length(date.list), 4)]
  axis(1,at=c(2,6,10,14,18,22),labels=date.list.seq, cex = 0.6)
  #Add prediction lines
  lines(datanew$no_of_weeks[1:240],pred1[1:240],col=col[1],lwd = 1.5) #regular model, 2019
  lines(datanew$no_of_weeks[241:480],pred1[241:480],col=col[2],lwd = 1.5) #regular model, 2020
  lockdown <- as.Date(lockdown.date)
  date.list.19 <- data$Date[1:24]
  date.list.20 <- data$Date[25:48]
  index <- which(date.list.20 %in% lockdown)
  title(paste(location,"NO2,", index.type, "as interruption,\n", as.character(format(date.list.19[[index-12]], "%b %d %Y")), "-", as.character(format(date.list.19[[index+11]], "%b %d %Y")), "vs", as.character(format((date.list.19[[index-12]] %m+% years(1)),"%b %d %Y")), "-", as.character(format((date.list.19[[index+11]] %m+% years(1)),"%b %d %Y"))), cex = 0.5)

  # to plot the counterfactual scenario we create a data frame as if covid lockdown (the intervention) was never being implemented
    datanew.ctr <- data.frame(NO2_Concentration=mean(data$NO2_Concentration),covid_lockdown=0, no_of_weeks=c((1:240/10), (1:240/10)), year2020 = rep(c(0,1),c(240, 240)))

  # generate predictions under the counterfactual scenario and add it to the plot
  pred1b <- predict(model,datanew.ctr, type="response") #/mean(data$pollution_estimate)*10
   
  lines(datanew.ctr$no_of_weeks[1:240],pred1b[1:240],col=col[1],lty=2,lwd = 1.5) #counterfactual model, 2019
  lines(datanew.ctr$no_of_weeks[241:480],pred1b[241:480],col=col[2],lty=2,lwd = 1.5) #counterfactual model, 2020
}

#Saves plots as PDFs in urban/rural pairs. 
plot.save.fxn <- function(location) {
  plot1 <- cowplot::plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".schoolclosing.pdf"), path = "ITS_plots", plot1, width = 17, height = 10, units = "cm")
  plot2 <- cowplot::plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  ggsave(paste0(location, ".workplaceclosing.pdf"), path = "ITS_plots", plot2, width = 17, height = 10, units = "cm")
  plot3 <- cowplot::plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  ggsave(paste0(location, ".cancelevents.pdf"), path = "ITS_plots", plot3, width = 17, height = 10, units = "cm")
  plot4 <- cowplot::plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  ggsave(paste0(location, ".restrictgatherings.pdf"), path = "ITS_plots", plot4, width = 17, height = 10, units = "cm")
  plot5 <- cowplot::plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  ggsave(paste0(location, ".closetransport.pdf"), path = "ITS_plots", plot5, width = 17, height = 10, units = "cm")
  plot6 <- cowplot::plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  ggsave(paste0(location, ".stayathome.pdf"), path = "ITS_plots", plot6, width = 17, height = 10, units = "cm")
  plot7 <- cowplot::plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  ggsave(paste0(location, ".restrictinternal.pdf"), path = "ITS_plots", plot7, width = 17, height = 10, units = "cm")
  plot8 <- cowplot::plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
  plot9 <- cowplot::plot_grid(urban.plots[[9]], rural.plots[[9]], ncol = 2, labels = c('Q', 'R'))
  ggsave(paste0(location, ".stringencyindex.pdf"), path = "ITS_plots", plot9, width = 17, height = 10, units = "cm")
}

plot.print.fxn <- function() {
  plot1 <- cowplot::plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot2 <- cowplot::plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  plot3 <- cowplot::plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  plot4 <- cowplot::plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  plot5 <- cowplot::plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  plot6 <- cowplot::plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  plot7 <- cowplot::plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  plot8 <- cowplot::plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  plot9 <- cowplot::plot_grid(urban.plots[[9]], rural.plots[[9]], ncol = 2, labels = c('Q', 'R'))
  plot.a <- cowplot::plot_grid(plot1, plot2, ncol = 1)
  plot.b <- cowplot::plot_grid(plot3, plot4, ncol = 1)
  plot.c <- cowplot::plot_grid(plot5, plot6, ncol = 1)
  plot.d <- cowplot::plot_grid(plot7, plot8, ncol = 1)
  plot.e <- cowplot::plot_grid(plot9, NULL, ncol = 1)
  l <- list(plot.a, plot.b, plot.c, plot.d, plot.e)
  return(l)
}

res.fxn <- function(data, location, index.type) {
  data.2019 <- data %>% filter(., year2020 == 0) %>% select(., NO2_Concentration, no_of_weeks, covid_lockdown) 
  period.model.urban <- lm(NO2_Concentration ~ no_of_weeks+ covid_lockdown+ no_of_weeks*covid_lockdown, data=data.2019)  
  res <- residuals(period.model.urban,type="deviance")
  plot(data.2019$no_of_weeks,res,ylim=c(-5E-5,5E-5),pch=19,cex=0.7,col=alpha(col[1],0.5),ylab="Deviance residuals",xlab="Date", xaxt = "n")
  data.2020 <- data %>% filter(., year2020 == 1) %>% select(., NO2_Concentration, no_of_weeks, covid_lockdown) 
  period.model.urban <- lm(NO2_Concentration ~ no_of_weeks+ covid_lockdown+ no_of_weeks*covid_lockdown, data=data.2020)  
  res <- residuals(period.model.urban,type="deviance")
  par(new=TRUE)
  plot(data.2020$no_of_weeks,res,ylim=c(-5E-5,5E-5),pch=19,cex=0.7,col=alpha(col[2],0.5),ylab="Deviance residuals",xlab="Date", xaxt = "n")
  date.list <- data$Date %>% as.Date() %>% format("%b %d")
  date.list <- date.list[1:24]
  date.list.seq <- date.list[seq(2, length(date.list), 4)]
  axis(1,at=c(2,6,10,14,18,22),labels=date.list.seq)
  title(paste0("Residuals over time, ", location, ",\n", index.type, " as interruption"))
  legend("topright", inset=.05, legend=c("2019", "2020"), col=alpha(col,0.5),pch=16,cex=0.7)
  abline(h=0,lty=2,lwd=2)
}

#Plan: make dt for each model, merge all rows together in end, and group columns by model type and rows by country and region 
results.df.fxn <- function(model.list, index.titles, location) {
  # set names for the list
  names(model.list) <- index.titles
  # tidy them up
  sep.df <- purrr::pmap(list(model.list), broom::tidy)
  sep.df <- purrr::map(sep.df, function(x) {x %>% .[c(6, 8), ] %>% select(Predictors = term, p = p.value)
  })
  # set the list names at the beginning of each column
  sep.df <- purrr::imap(sep.df, ~purrr::set_names(.x, paste(.y, names(.x), sep = "_")))
  # rename each term column as "term"
  sep.df <- purrr::map(sep.df, ~rename_with(.x, str_replace, pattern = ".*Predictors", replacement = "Predictors"))
  # join them all together
  joined.results <- purrr::reduce(sep.df, full_join, by = "Predictors")
  Location <- location
  cbind(Location, joined.results)
}
```

### World 
```{r,fig.width = 6, fig.height = 4, eval = FALSE}
#Urban and rural data frame lists. 
world.urban.df.list <- purrr::pmap(list("World", "urban", "whodeclaration", as.Date("2020-01-23")), NO2.df.filter.fxn)
world.rural.df.list <- purrr::pmap(list("World", "urban", "whodeclaration", as.Date("2020-01-23")), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(world.urban.df.list, 10E-5, "Urban World", "WHO Declaration of Pandemic"), scatter_gplot)
purrr::pmap(list(world.rural.df.list, 10E-5, "Rural World", "WHO Declaration of Pandemic"), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = FALSE}
#Tabulate pollution before and after lockdown
purrr::map(world.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(world.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(world.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(world.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
world.urban.model.list <- purrr::pmap(list(world.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(world.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(world.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban World Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

world.rural.model.list <- purrr::pmap(list(world.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(world.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(world.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural World Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(world.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), as.Date("2020-01-23"), "WHO Declaration of Pandemic", world.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("World", 1), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(world.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), as.Date("2020-01-23"), "WHO Declaration of Pandemic", world.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("World", 1), rural.plot.fxn)
plot.save.fxn("World")
plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = FALSE}
purrr::pmap(list(world.urban.df.list, "urban World", "WHO Declaration of Pandemic"), res.fxn) #Residuals plots. 
purrr::pmap(list(world.rural.df.list, "rural World", "WHO Declaration of Pandemic"), res.fxn)
```


### Poland
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
poland.urban.df.list <- purrr::pmap(list("Poland", "urban", file.index.list, stringencyindex.split.country.df[[1]]$lockdown.date), NO2.df.filter.fxn)
poland.rural.df.list <- purrr::pmap(list("Poland", "rural", file.index.list, stringencyindex.split.country.df[[1]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(poland.urban.df.list, 10E-5, "Urban Poland", index.title.list), scatter_gplot)
purrr::pmap(list(poland.rural.df.list, 10E-5, "Rural Poland", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval - TRUE}
#Tabulate pollution before and after lockdown
purrr::map(poland.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(poland.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(poland.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(poland.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
poland.urban.model.list <- purrr::pmap(list(poland.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(poland.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(poland.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Poland Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
poland.rural.model.list <- purrr::pmap(list(poland.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(poland.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(poland.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Poland Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(poland.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[1]]$lockdown.date[[n]], index.title.list[[n]], poland.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Poland", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(poland.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[1]]$lockdown.date[[n]], index.title.list[[n]], poland.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Poland", 1:9), rural.plot.fxn)
plot.save.fxn("Poland")
plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(poland.urban.df.list, "urban Poland", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(poland.rural.df.list, "rural Poland", index.title.list), res.fxn)
```


### Slovakia
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
slovakia.urban.df.list <- purrr::pmap(list("Slovakia", "urban", file.index.list, stringencyindex.split.country.df[[2]]$lockdown.date), NO2.df.filter.fxn)
slovakia.rural.df.list <- purrr::pmap(list("Slovakia", "rural", file.index.list, stringencyindex.split.country.df[[2]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(slovakia.urban.df.list, 10E-5, "Urban Slovakia", index.title.list), scatter_gplot)
purrr::pmap(list(slovakia.rural.df.list, 10E-5, "Rural Slovakia", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(slovakia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(slovakia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(slovakia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(slovakia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
slovakia.urban.model.list <- purrr::pmap(list(slovakia.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(slovakia.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(slovakia.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Slovakia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
slovakia.rural.model.list <- purrr::pmap(list(slovakia.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(slovakia.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(slovakia.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Slovakia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(slovakia.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[2]]$lockdown.date[[n]], index.title.list[[n]], slovakia.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Slovakia", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(slovakia.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[2]]$lockdown.date[[n]], index.title.list[[n]], slovakia.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Slovakia", 1:9), rural.plot.fxn)
plot.save.fxn("Slovakia")
plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(slovakia.urban.df.list, "urban Slovakia", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(slovakia.rural.df.list, "rural Slovakia", index.title.list), res.fxn)
```


### Czechia
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
czechia.urban.df.list <- purrr::pmap(list("Czechia", "urban", file.index.list, stringencyindex.split.country.df[[3]]$lockdown.date), NO2.df.filter.fxn)
czechia.rural.df.list <- purrr::pmap(list("Czechia", "rural", file.index.list, stringencyindex.split.country.df[[3]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(czechia.urban.df.list, 10E-5, "Urban Czechia", index.title.list), scatter_gplot)
purrr::pmap(list(czechia.rural.df.list, 10E-5, "Rural Czechia", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(czechia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(czechia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(czechia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(czechia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
czechia.urban.model.list <- purrr::pmap(list(czechia.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(czechia.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(czechia.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Czechia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
czechia.rural.model.list <- purrr::pmap(list(czechia.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(czechia.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(czechia.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Czechia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(czechia.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[3]]$lockdown.date[[n]], index.title.list[[n]], czechia.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Czechia", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(czechia.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[3]]$lockdown.date[[n]], index.title.list[[n]], czechia.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Czechia", 1:9), rural.plot.fxn)
plot.save.fxn("Czechia")
plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(czechia.urban.df.list, "urban Czechia", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(czechia.rural.df.list, "rural Czechia", index.title.list), res.fxn)
```


### South Korea
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
southkorea.urban.df.list <- purrr::pmap(list("South Korea", "urban", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[4]]$lockdown.date), NO2.df.filter.fxn)
southkorea.rural.df.list <- purrr::pmap(list("South Korea", "rural", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[4]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(southkorea.urban.df.list, 10E-5, "Urban South Korea", index.title.list[c(1:4, 6:9)]), scatter_gplot)
purrr::pmap(list(southkorea.rural.df.list, 10E-5, "Rural South Korea", index.title.list[c(1:4, 6:9)]), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(southkorea.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(southkorea.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(southkorea.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(southkorea.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
southkorea.urban.model.list <- purrr::pmap(list(southkorea.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(southkorea.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(southkorea.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban South Korea Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 
southkorea.rural.model.list <- purrr::pmap(list(southkorea.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(southkorea.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(southkorea.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural South Korea Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(southkorea.urban.df.list[[n]], ylim=2E-4, paste("Urban", country), stringencyindex.split.country.df[[4]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], southkorea.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("South Korea", 1:8), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(southkorea.rural.df.list[[n]], ylim=2E-4, paste("Rural", country), stringencyindex.split.country.df[[4]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], southkorea.rural.model.list[[n]])
  }
}

rural.plots <- purrr::pmap(list("South Korea", 1:8), rural.plot.fxn)

#Saves plots as PDFs in urban/rural pairs. 
skorea.plot.save.fxn <- function(location) {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".schoolclosing.pdf"), path = "ITS_plots", plot1, width = 17, height = 10, units = "cm")
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  ggsave(paste0(location, ".workplaceclosing.pdf"), path = "ITS_plots", plot2, width = 17, height = 10, units = "cm")
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  ggsave(paste0(location, ".cancelevents.pdf"), path = "ITS_plots", plot3, width = 17, height = 10, units = "cm")
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  ggsave(paste0(location, ".restrictgatherings.pdf"), path = "ITS_plots", plot4, width = 17, height = 10, units = "cm")
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  ggsave(paste0(location, ".stayathome.pdf"), path = "ITS_plots", plot6, width = 17, height = 10, units = "cm")
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  ggsave(paste0(location, ".restrictinternal.pdf"), path = "ITS_plots", plot7, width = 17, height = 10, units = "cm")
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  ggsave(paste0(location, ".stringencyindex.pdf"), path = "ITS_plots", plot9, width = 17, height = 10, units = "cm")
}

skorea.plot.print.fxn <- function() {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  plot.a <- plot_grid(plot1, plot2, ncol = 1)
  plot.b <- plot_grid(plot3, plot4, ncol = 1)
  plot.c <- plot_grid(plot6, plot7, ncol = 1)
  plot.d <- plot_grid(plot8, plot9, ncol = 1)
  l <- list(plot.a, plot.b, plot.c, plot.d)
  return(l)
}

skorea.plot.save.fxn("South Korea")
skorea.plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(southkorea.urban.df.list, "urban South Korea", index.title.list[c(1:4, 6:9)]), res.fxn) #Residuals plots. 
purrr::pmap(list(southkorea.rural.df.list, "rural South Korea", index.title.list[c(1:4, 6:9)]), res.fxn)
```


### Germany
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
germany.urban.df.list <- purrr::pmap(list("Germany", "urban", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[5]]$lockdown.date), NO2.df.filter.fxn)
germany.rural.df.list <- purrr::pmap(list("Germany", "rural", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[5]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(germany.urban.df.list, 10E-5, "Urban Germany", index.title.list[c(1:4, 6:9)]), scatter_gplot)
purrr::pmap(list(germany.rural.df.list, 10E-5, "Rural Germany", index.title.list[c(1:4, 6:9)]), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(germany.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(germany.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(germany.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(germany.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
germany.urban.model.list <- purrr::pmap(list(germany.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(germany.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(germany.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Germany Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 
germany.rural.model.list <- purrr::pmap(list(germany.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(germany.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(germany.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Germany Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(germany.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[5]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], germany.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Germany", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(germany.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[5]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], germany.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Germany", 1:9), rural.plot.fxn)

#Saves plots as PDFs in urban/rural pairs. 
germany.plot.save.fxn <- function(location) {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".schoolclosing.pdf"), path = "ITS_plots", plot1, width = 17, height = 10, units = "cm")
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  ggsave(paste0(location, ".workplaceclosing.pdf"), path = "ITS_plots", plot2, width = 17, height = 10, units = "cm")
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  ggsave(paste0(location, ".cancelevents.pdf"), path = "ITS_plots", plot3, width = 17, height = 10, units = "cm")
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  ggsave(paste0(location, ".restrictgatherings.pdf"), path = "ITS_plots", plot4, width = 17, height = 10, units = "cm")
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  ggsave(paste0(location, ".stayathome.pdf"), path = "ITS_plots", plot6, width = 17, height = 10, units = "cm")
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  ggsave(paste0(location, ".restrictinternal.pdf"), path = "ITS_plots", plot7, width = 17, height = 10, units = "cm")
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  ggsave(paste0(location, ".stringencyindex.pdf"), path = "ITS_plots", plot9, width = 17, height = 10, units = "cm")
}

germany.plot.print.fxn <- function() {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  plot.a <- plot_grid(plot1, plot2, ncol = 1)
  plot.b <- plot_grid(plot3, plot4, ncol = 1)
  plot.c <- plot_grid(plot6, plot7, ncol = 1)
  plot.d <- plot_grid(plot8, plot9, ncol = 1)
  l <- list(plot.a, plot.b, plot.c, plot.d)
  return(l)
}

germany.plot.save.fxn("Germany")
germany.plot.print.fxn()
```

```{r, fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(germany.urban.df.list, "urban Germany", index.title.list[c(1:4, 6:9)]), res.fxn) #Residuals plots. 
purrr::pmap(list(germany.rural.df.list, "rural Germany", index.title.list[c(1:4, 6:9)]), res.fxn)
```


### Japan
```{r,fig.width = 6, fig.height = 4,  eval = TRUE}
#Urban and rural data frame lists. 
japan.urban.df.list <- purrr::pmap(list("Japan", "urban", file.index.list[c(1:3, 6:9)], stringencyindex.split.country.df[[6]]$lockdown.date), NO2.df.filter.fxn)
japan.rural.df.list <- purrr::pmap(list("Japan", "rural", file.index.list[c(1:3, 6:9)], stringencyindex.split.country.df[[6]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(japan.urban.df.list, 10E-5, "Urban Japan", index.title.list[c(1:3, 6:9)]), scatter_gplot)
purrr::pmap(list(japan.rural.df.list, 10E-5, "Rural Japan", index.title.list[c(1:3, 6:9)]), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(japan.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(japan.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(japan.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(japan.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
japan.urban.model.list <- purrr::pmap(list(japan.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(japan.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(japan.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Japan Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:3, 6:9)])) #Table of p values. 
japan.rural.model.list <- purrr::pmap(list(japan.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(japan.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(japan.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Japan Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:3, 6:9)])) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(japan.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[6]]$lockdown.date[[n]], index.title.list[c(1:3, 6:9)][[n]], japan.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Japan", 1:7), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(japan.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[6]]$lockdown.date[[n]], index.title.list[c(1:3, 6:9)][[n]], japan.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Japan", 1:7), rural.plot.fxn)

#Saves plots as PDFs in urban/rural pairs. 
japan.plot.save.fxn <- function(location) {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".schoolclosing.pdf"), path = "ITS_plots", plot1, width = 17, height = 10, units = "cm")
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  ggsave(paste0(location, ".workplaceclosing.pdf"), path = "ITS_plots", plot2, width = 17, height = 10, units = "cm")
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  ggsave(paste0(location, ".cancelevents.pdf"), path = "ITS_plots", plot3, width = 17, height = 10, units = "cm")
  plot6 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  ggsave(paste0(location, ".stayathome.pdf"), path = "ITS_plots", plot6, width = 17, height = 10, units = "cm")
  plot7 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  ggsave(paste0(location, ".restrictinternal.pdf"), path = "ITS_plots", plot7, width = 17, height = 10, units = "cm")
  plot8 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
  plot9 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  ggsave(paste0(location, ".stringencyindex.pdf"), path = "ITS_plots", plot9, width = 17, height = 10, units = "cm")
}

japan.plot.print.fxn <- function() {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  plot6 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  plot7 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  plot8 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  plot9 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  plot.a <- plot_grid(plot1, plot2, ncol = 1)
  plot.b <- plot_grid(plot3, plot6, ncol = 1)
  plot.c <- plot_grid(plot7, plot8, ncol = 1)
  plot.d <- plot_grid(plot9, NULL, ncol = 1)
  l <- list(plot.a, plot.b, plot.c, plot.d)
  return(l)
}

japan.plot.save.fxn("Japan")
japan.plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(japan.urban.df.list, "urban Japan", index.title.list[c(1:3, 6:9)]), res.fxn) #Residuals plots. 
purrr::pmap(list(japan.rural.df.list, "rural Japan", index.title.list[c(1:3, 6:9)]), res.fxn)
```


### Panama 
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
panama.urban.df.list <- purrr::pmap(list("Panama", "urban", file.index.list, stringencyindex.split.country.df[[7]]$lockdown.date), NO2.df.filter.fxn)
panama.rural.df.list <- purrr::pmap(list("Panama", "rural", file.index.list, stringencyindex.split.country.df[[7]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(panama.urban.df.list, 10E-5, "Urban Panama", index.title.list), scatter_gplot)
purrr::pmap(list(panama.rural.df.list, 10E-5, "Rural Panama", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(panama.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(panama.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(panama.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(panama.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
panama.urban.model.list <- purrr::pmap(list(panama.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(panama.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(panama.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Panama Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
panama.rural.model.list <- purrr::pmap(list(panama.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(panama.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(panama.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Panama Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(panama.urban.df.list[[n]], ylim=3E-5, paste("Urban", country), stringencyindex.split.country.df[[7]]$lockdown.date[[n]], index.title.list[[n]], panama.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Panama", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(panama.rural.df.list[[n]], ylim=3E-5, paste("Rural", country), stringencyindex.split.country.df[[7]]$lockdown.date[[n]], index.title.list[[n]], panama.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Panama", 1:9), rural.plot.fxn)
plot.save.fxn("Panama")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(panama.urban.df.list, "urban Panama", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(panama.rural.df.list, "rural Panama", index.title.list), res.fxn)
```


### Guatemala
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
guatemala.urban.df.list <- purrr::pmap(list("Guatemala", "urban", file.index.list, stringencyindex.split.country.df[[8]]$lockdown.date), NO2.df.filter.fxn)
guatemala.rural.df.list <- purrr::pmap(list("Guatemala", "rural", file.index.list, stringencyindex.split.country.df[[8]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(guatemala.urban.df.list, 10E-5, "Urban Guatemala", index.title.list), scatter_gplot)
purrr::pmap(list(guatemala.rural.df.list, 10E-5, "Rural Guatemala", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(guatemala.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(guatemala.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(guatemala.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(guatemala.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
guatemala.urban.model.list <- purrr::pmap(list(guatemala.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(guatemala.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(guatemala.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Guatemala Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
guatemala.rural.model.list <- purrr::pmap(list(guatemala.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(guatemala.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(guatemala.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Guatemala Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(guatemala.urban.df.list[[n]], ylim=3E-5, paste("Urban", country), stringencyindex.split.country.df[[8]]$lockdown.date[[n]], index.title.list[[n]], guatemala.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Guatemala", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(guatemala.rural.df.list[[n]], ylim=3E-5, paste("Rural", country), stringencyindex.split.country.df[[8]]$lockdown.date[[n]], index.title.list[[n]], guatemala.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Guatemala", 1:9), rural.plot.fxn)
plot.save.fxn("Guatemala")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(guatemala.urban.df.list, "urban Guatemala", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(guatemala.rural.df.list, "rural Guatemala", index.title.list), res.fxn)
```


### Brazil
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
brazil.urban.df.list <- purrr::pmap(list("Brazil", "urban", file.index.list, stringencyindex.split.country.df[[9]]$lockdown.date), NO2.df.filter.fxn)
brazil.rural.df.list <- purrr::pmap(list("Brazil", "rural", file.index.list, stringencyindex.split.country.df[[9]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(brazil.urban.df.list, 10E-5, "Urban Brazil", index.title.list), scatter_gplot)
purrr::pmap(list(brazil.rural.df.list, 10E-5, "Rural Brazil", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(brazil.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(brazil.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(brazil.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(brazil.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
brazil.urban.model.list <- purrr::pmap(list(brazil.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(brazil.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(brazil.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Brazil Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
brazil.rural.model.list <- purrr::pmap(list(brazil.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(brazil.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(brazil.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Brazil Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(brazil.urban.df.list[[n]], ylim=2.5E-5, paste("Urban", country), stringencyindex.split.country.df[[9]]$lockdown.date[[n]], index.title.list[[n]], brazil.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Brazil", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(brazil.rural.df.list[[n]], ylim=2.5E-5, paste("Rural", country), stringencyindex.split.country.df[[9]]$lockdown.date[[n]], index.title.list[[n]], brazil.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Brazil", 1:9), rural.plot.fxn)
plot.save.fxn("Brazil")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(brazil.urban.df.list, "urban Brazil", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(brazil.rural.df.list, "rural Brazil", index.title.list), res.fxn)
```


### Iraq
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
iraq.urban.df.list <- purrr::pmap(list("Iraq", "urban", file.index.list, stringencyindex.split.country.df[[10]]$lockdown.date), NO2.df.filter.fxn)
iraq.rural.df.list <- purrr::pmap(list("Iraq", "rural", file.index.list, stringencyindex.split.country.df[[10]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(iraq.urban.df.list, 10E-5, "Urban Iraq", index.title.list), scatter_gplot)
purrr::pmap(list(iraq.rural.df.list, 10E-5, "Rural Iraq", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(iraq.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(iraq.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(iraq.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(iraq.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
iraq.urban.model.list <- purrr::pmap(list(iraq.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(iraq.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(iraq.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Iraq Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
iraq.rural.model.list <- purrr::pmap(list(iraq.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(iraq.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(iraq.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Iraq Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(iraq.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[10]]$lockdown.date[[n]], index.title.list[[n]], iraq.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Iraq", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(iraq.rural.df.list[[n]], ylim=10E-5, paste("Iraq", country), stringencyindex.split.country.df[[10]]$lockdown.date[[n]], index.title.list[[n]], iraq.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Iraq", 1:9), rural.plot.fxn)
plot.save.fxn("Iraq")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(iraq.urban.df.list, "urban Iraq", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(iraq.rural.df.list, "rural Iraq", index.title.list), res.fxn)
```


### Egypt
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
egypt.urban.df.list <- purrr::pmap(list("Egypt", "urban", file.index.list, stringencyindex.split.country.df[[11]]$lockdown.date), NO2.df.filter.fxn)
egypt.rural.df.list <- purrr::pmap(list("Egypt", "rural", file.index.list, stringencyindex.split.country.df[[11]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(egypt.urban.df.list, 10E-5, "Urban Egypt", index.title.list), scatter_gplot)
purrr::pmap(list(egypt.rural.df.list, 10E-5, "Rural Egypt", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(egypt.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(egypt.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(egypt.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(egypt.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
egypt.urban.model.list <- purrr::pmap(list(egypt.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(egypt.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(egypt.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"),title = "ITS: Urban Egypt Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
egypt.rural.model.list <- purrr::pmap(list(egypt.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(egypt.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(egypt.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Egypt Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(egypt.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[11]]$lockdown.date[[n]], index.title.list[[n]], egypt.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Egypt", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(egypt.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[11]]$lockdown.date[[n]], index.title.list[[n]], egypt.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Egypt", 1:9), rural.plot.fxn)
plot.save.fxn("Egypt")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(egypt.urban.df.list, "urban Egypt", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(egypt.rural.df.list, "rural Egypt", index.title.list), res.fxn)
```


### Syria
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
syria.urban.df.list <- purrr::pmap(list("Syria", "urban", file.index.list, stringencyindex.split.country.df[[12]]$lockdown.date), NO2.df.filter.fxn)
syria.rural.df.list <- purrr::pmap(list("Syria", "rural", file.index.list, stringencyindex.split.country.df[[12]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(syria.urban.df.list, 10E-5, "Urban Syria", index.title.list), scatter_gplot)
purrr::pmap(list(syria.rural.df.list, 10E-5, "Rural Syria", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(syria.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(syria.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(syria.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(syria.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
syria.urban.model.list <- purrr::pmap(list(syria.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(syria.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(syria.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Syria Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
syria.rural.model.list <- purrr::pmap(list(syria.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(syria.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(syria.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Syria Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(syria.urban.df.list[[n]], ylim=8E-5, paste("Urban", country), stringencyindex.split.country.df[[12]]$lockdown.date[[n]], index.title.list[[n]], syria.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Syria", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(syria.rural.df.list[[n]], ylim=8E-5, paste("Rural", country), stringencyindex.split.country.df[[12]]$lockdown.date[[n]], index.title.list[[n]], syria.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Syria", 1:9), rural.plot.fxn)
plot.save.fxn("Syria")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(syria.urban.df.list, "urban Syria", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(syria.rural.df.list, "rural Syria", index.title.list), res.fxn)
```


### India
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
india.urban.df.list <- purrr::pmap(list("India", "urban", file.index.list, stringencyindex.split.country.df[[13]]$lockdown.date), NO2.df.filter.fxn)
india.rural.df.list <- purrr::pmap(list("India", "rural", file.index.list, stringencyindex.split.country.df[[13]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(india.urban.df.list, 10E-5, "Urban India", index.title.list), scatter_gplot)
purrr::pmap(list(india.rural.df.list, 10E-5, "Rural India", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(india.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(india.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(india.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(india.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
india.urban.model.list <- purrr::pmap(list(india.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(india.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(india.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban India Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
india.rural.model.list <- purrr::pmap(list(india.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(india.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(india.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural India Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(india.urban.df.list[[n]], ylim=8E-5, paste("Urban", country), stringencyindex.split.country.df[[13]]$lockdown.date[[n]], index.title.list[[n]], india.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("India", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(india.rural.df.list[[n]], ylim=8E-5, paste("Rural", country), stringencyindex.split.country.df[[13]]$lockdown.date[[n]], index.title.list[[n]], india.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("India", 1:9), rural.plot.fxn)
plot.save.fxn("India")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(india.urban.df.list, "urban India", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(india.rural.df.list, "rural India", index.title.list), res.fxn)
```


### Pakistan
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
pakistan.urban.df.list <- purrr::pmap(list("Pakistan", "urban", file.index.list, stringencyindex.split.country.df[[14]]$lockdown.date), NO2.df.filter.fxn)
pakistan.rural.df.list <- purrr::pmap(list("Pakistan", "rural", file.index.list, stringencyindex.split.country.df[[14]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(pakistan.urban.df.list, 10E-5, "Urban Pakistan", index.title.list), scatter_gplot)
purrr::pmap(list(pakistan.rural.df.list, 10E-5, "Rural Pakistan", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(pakistan.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(pakistan.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(pakistan.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(pakistan.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
pakistan.urban.model.list <- purrr::pmap(list(pakistan.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(pakistan.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(pakistan.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Pakistan Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
pakistan.rural.model.list <- purrr::pmap(list(pakistan.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(pakistan.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(pakistan.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Pakistan Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(pakistan.urban.df.list[[n]], ylim=8E-5, paste("Urban", country), stringencyindex.split.country.df[[14]]$lockdown.date[[n]], index.title.list[[n]], pakistan.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Pakistan", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(pakistan.rural.df.list[[n]], ylim=8E-5, paste("Rural", country), stringencyindex.split.country.df[[14]]$lockdown.date[[n]], index.title.list[[n]], pakistan.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Pakistan", 1:9), rural.plot.fxn)
plot.save.fxn("Pakistan")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(pakistan.urban.df.list, "urban Pakistan", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(pakistan.rural.df.list, "rural Pakistan", index.title.list), res.fxn)
```


### Bangladesh
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
bangladesh.urban.df.list <- purrr::pmap(list("Bangladesh", "urban", file.index.list, stringencyindex.split.country.df[[15]]$lockdown.date), NO2.df.filter.fxn)
bangladesh.rural.df.list <- purrr::pmap(list("Bangladesh", "rural", file.index.list, stringencyindex.split.country.df[[15]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(bangladesh.urban.df.list, 10E-5, "Urban Bangladesh", index.title.list), scatter_gplot)
purrr::pmap(list(bangladesh.rural.df.list, 10E-5, "Rural Bangladesh", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(bangladesh.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(bangladesh.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(bangladesh.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(bangladesh.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
bangladesh.urban.model.list <- purrr::pmap(list(bangladesh.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(bangladesh.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(bangladesh.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Bangladesh Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
bangladesh.rural.model.list <- purrr::pmap(list(bangladesh.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(bangladesh.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(bangladesh.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Bangladesh Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(bangladesh.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[15]]$lockdown.date[[n]], index.title.list[[n]], bangladesh.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Bangladesh", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(bangladesh.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[15]]$lockdown.date[[n]], index.title.list[[n]], bangladesh.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Bangladesh", 1:9), rural.plot.fxn)
plot.save.fxn("Bangladesh")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(bangladesh.urban.df.list, "urban Bangladesh", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(bangladesh.rural.df.list, "rural Bangladesh", index.title.list), res.fxn)
```


### China 
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
china.urban.df.list <- purrr::pmap(list("China", "urban", file.index.list, stringencyindex.split.country.df[[16]]$lockdown.date), NO2.df.filter.fxn)
china.rural.df.list <- purrr::pmap(list("China", "rural", file.index.list, stringencyindex.split.country.df[[16]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(china.urban.df.list, 10E-5, "Urban China", index.title.list), scatter_gplot)
purrr::pmap(list(china.rural.df.list, 10E-5, "Rural China", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(china.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(china.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(china.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(china.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
china.urban.model.list <- purrr::pmap(list(china.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(china.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(china.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban China Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
china.rural.model.list <- purrr::pmap(list(china.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(china.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(china.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural China Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(china.urban.df.list[[n]], ylim=3E-4, paste("Urban", country), stringencyindex.split.country.df[[16]]$lockdown.date[[n]], index.title.list[[n]], china.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("China", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(china.rural.df.list[[n]], ylim=3E-4, paste("Rural", country), stringencyindex.split.country.df[[16]]$lockdown.date[[n]], index.title.list[[n]], china.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("China", 1:9), rural.plot.fxn)
plot.save.fxn("China")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(china.urban.df.list, "urban China", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(china.rural.df.list, "rural China", index.title.list), res.fxn)
```

### North Korea
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
northkorea.urban.df.list <- purrr::pmap(list("North Korea", "urban", file.index.list[8], stringencyindex.split.country.df[[17]]$lockdown.date), NO2.df.filter.fxn)
northkorea.rural.df.list <- purrr::pmap(list("North Korea", "rural", file.index.list[8], stringencyindex.split.country.df[[17]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(northkorea.urban.df.list, 10E-5, "Urban North Korea", index.title.list[8]), scatter_gplot)
purrr::pmap(list(northkorea.rural.df.list, 10E-5, "Rural North Korea", index.title.list[8]), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(northkorea.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(northkorea.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(northkorea.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(northkorea.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
northkorea.urban.model.list <- purrr::pmap(list(northkorea.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(northkorea.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(northkorea.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban North Korea Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[[8]])) #Table of p values. 
northkorea.rural.model.list <- purrr::pmap(list(northkorea.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(northkorea.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(northkorea.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural North Korea Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[[8]])) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(northkorea.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[17]]$lockdown.date[[n]], index.title.list[8][[n]], northkorea.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("North Korea", 1), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(northkorea.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[17]]$lockdown.date[[n]], index.title.list[8][[n]], northkorea.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("North Korea", 1), rural.plot.fxn)

#Saves plots as PDFs in urban/rural pairs. 
nkorea.plot.save.fxn <- function(location) {
  plot8 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
}

nkorea.plot.print.fxn <- function() {
  plot8 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot.a <- plot_grid(plot8, NULL, ncol = 1)
  l <- list(plot.a)
  return(l)
}

nkorea.plot.save.fxn("North Korea")
nkorea.plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(northkorea.urban.df.list, "urban North Korea", index.title.list[8]), res.fxn) #Residuals plots. 
purrr::pmap(list(northkorea.rural.df.list, "rural North Korea", index.title.list[8]), res.fxn)
```


### Malaysia
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
malaysia.urban.df.list <- purrr::pmap(list("Malaysia", "urban", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[18]]$lockdown.date), NO2.df.filter.fxn)
malaysia.rural.df.list <- purrr::pmap(list("Malaysia", "rural", file.index.list[c(1:4, 6:9)], stringencyindex.split.country.df[[18]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(malaysia.urban.df.list, 10E-5, "Urban Malaysia", index.title.list[c(1:4, 6:9)]), scatter_gplot)
purrr::pmap(list(malaysia.rural.df.list, 10E-5, "Rural Malaysia", index.title.list[c(1:4, 6:9)]), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(malaysia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(malaysia.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(malaysia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(malaysia.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
malaysia.urban.model.list <- purrr::pmap(list(malaysia.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(malaysia.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(malaysia.urban.model.list,terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Malaysia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 
malaysia.rural.model.list <- purrr::pmap(list(malaysia.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(malaysia.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(malaysia.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Malaysia Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list[c(1:4, 6:9)])) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(malaysia.urban.df.list[[n]], ylim=5E-5, paste("Urban", country), stringencyindex.split.country.df[[18]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], malaysia.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Malaysia", 1:8), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(malaysia.rural.df.list[[n]], ylim=5E-5, paste("Rural", country), stringencyindex.split.country.df[[18]]$lockdown.date[[n]], index.title.list[c(1:4, 6:9)][[n]], malaysia.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Malaysia", 1:8), rural.plot.fxn)

#Saves plots as PDFs in urban/rural pairs. 
malaysia.plot.save.fxn <- function(location) {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  ggsave(paste0(location, ".schoolclosing.pdf"), path = "ITS_plots", plot1, width = 17, height = 10, units = "cm")
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  ggsave(paste0(location, ".workplaceclosing.pdf"), path = "ITS_plots", plot2, width = 17, height = 10, units = "cm")
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  ggsave(paste0(location, ".cancelevents.pdf"), path = "ITS_plots", plot3, width = 17, height = 10, units = "cm")
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  ggsave(paste0(location, ".restrictgatherings.pdf"), path = "ITS_plots", plot4, width = 17, height = 10, units = "cm")
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  ggsave(paste0(location, ".stayathome.pdf"), path = "ITS_plots", plot6, width = 17, height = 10, units = "cm")
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  ggsave(paste0(location, ".restrictinternal.pdf"), path = "ITS_plots", plot7, width = 17, height = 10, units = "cm")
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  ggsave(paste0(location, ".restricttravel.pdf"), path = "ITS_plots", plot8, width = 17, height = 10, units = "cm")
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  ggsave(paste0(location, ".stringencyindex.pdf"), path = "ITS_plots", plot9, width = 17, height = 10, units = "cm")
}

malaysia.plot.print.fxn <- function() {
  plot1 <- plot_grid(urban.plots[[1]], rural.plots[[1]], ncol = 2, labels = c('A', 'B'))
  plot2 <- plot_grid(urban.plots[[2]], rural.plots[[2]], ncol = 2, labels = c('C', 'D'))
  plot3 <- plot_grid(urban.plots[[3]], rural.plots[[3]], ncol = 2, labels = c('E', 'F'))
  plot4 <- plot_grid(urban.plots[[4]], rural.plots[[4]], ncol = 2, labels = c('G', 'H'))
  plot6 <- plot_grid(urban.plots[[5]], rural.plots[[5]], ncol = 2, labels = c('I', 'J'))
  plot7 <- plot_grid(urban.plots[[6]], rural.plots[[6]], ncol = 2, labels = c('K', 'L'))
  plot8 <- plot_grid(urban.plots[[7]], rural.plots[[7]], ncol = 2, labels = c('M', 'N'))
  plot9 <- plot_grid(urban.plots[[8]], rural.plots[[8]], ncol = 2, labels = c('O', 'P'))
  plot.a <- plot_grid(plot1, plot2, ncol = 1)
  plot.b <- plot_grid(plot3, plot4, ncol = 1)
  plot.c <- plot_grid(plot6, plot7, ncol = 1)
  plot.d <- plot_grid(plot8, plot9, ncol = 1)
  l <- list(plot.a, plot.b, plot.c, plot.d)
  return(l)
}

malaysia.plot.save.fxn("Malaysia")
malaysia.plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(malaysia.urban.df.list, "urban Malaysia", index.title.list[c(1:4, 6:9)]), res.fxn) #Residuals plots. 
purrr::pmap(list(malaysia.rural.df.list, "rural Malaysia", index.title.list[c(1:4, 6:9)]), res.fxn)
```


### South Africa
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
southafrica.urban.df.list <- purrr::pmap(list("South Africa", "urban", file.index.list, stringencyindex.split.country.df[[19]]$lockdown.date), NO2.df.filter.fxn)
southafrica.rural.df.list <- purrr::pmap(list("South Africa", "rural", file.index.list, stringencyindex.split.country.df[[19]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(southafrica.urban.df.list, 10E-5, "Urban South Africa", index.title.list), scatter_gplot)
purrr::pmap(list(southafrica.rural.df.list, 10E-5, "Rural South Africa", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(southafrica.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(southafrica.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(southafrica.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(southafrica.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
southafrica.urban.model.list <- purrr::pmap(list(southafrica.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(southafrica.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(southafrica.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban South Africa Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
southafrica.rural.model.list <- purrr::pmap(list(southafrica.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(southafrica.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(southafrica.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural South Africa Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(southafrica.urban.df.list[[n]], ylim=10E-5, paste("Urban", country), stringencyindex.split.country.df[[19]]$lockdown.date[[n]], index.title.list[[n]], southafrica.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("South Africa", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(southafrica.rural.df.list[[n]], ylim=10E-5, paste("Rural", country), stringencyindex.split.country.df[[19]]$lockdown.date[[n]], index.title.list[[n]], southafrica.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("South Africa", 1:9), rural.plot.fxn)
plot.save.fxn("South Africa")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(southafrica.urban.df.list, "urban South Africa", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(southafrica.rural.df.list, "rural South Africa", index.title.list), res.fxn)
```


### Congo
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
congo.urban.df.list <- purrr::pmap(list("Congo", "urban", file.index.list, stringencyindex.split.country.df[[20]]$lockdown.date), NO2.df.filter.fxn)
congo.rural.df.list <- purrr::pmap(list("Congo", "rural", file.index.list, stringencyindex.split.country.df[[20]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(congo.urban.df.list, 10E-5, "Urban Congo", index.title.list), scatter_gplot)
purrr::pmap(list(congo.rural.df.list, 10E-5, "Rural Congo", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(congo.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(congo.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(congo.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(congo.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
congo.urban.model.list <- purrr::pmap(list(congo.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(congo.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(congo.urban.model.list,terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Congo Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
congo.rural.model.list <- purrr::pmap(list(congo.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(congo.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(congo.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Congo Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(congo.urban.df.list[[n]], ylim=6E-5, paste("Urban", country), stringencyindex.split.country.df[[20]]$lockdown.date[[n]], index.title.list[[n]], congo.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Congo", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(congo.rural.df.list[[n]], ylim=6E-5, paste("Rural", country), stringencyindex.split.country.df[[20]]$lockdown.date[[n]], index.title.list[[n]], congo.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Congo", 1:9), rural.plot.fxn)
plot.save.fxn("Congo")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(congo.urban.df.list, "urban Congo", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(congo.rural.df.list, "rural Congo", index.title.list), res.fxn)
```


### Nigeria 
```{r,fig.width = 6, fig.height = 4, eval = TRUE}
#Urban and rural data frame lists. 
nigeria.urban.df.list <- purrr::pmap(list("Nigeria", "urban", file.index.list, stringencyindex.split.country.df[[21]]$lockdown.date), NO2.df.filter.fxn)
nigeria.rural.df.list <- purrr::pmap(list("Nigeria", "rural", file.index.list, stringencyindex.split.country.df[[21]]$lockdown.date), NO2.df.filter.fxn)

#Scatter plots
purrr::pmap(list(nigeria.urban.df.list, 10E-5, "Urban Nigeria", index.title.list), scatter_gplot)
purrr::pmap(list(nigeria.rural.df.list, 10E-5, "Rural Nigeria", index.title.list), scatter_gplot)
```

```{r, fig.width = 8, fig.height = 8, eval = TRUE}
#Tabulate pollution before and after lockdown
purrr::map(nigeria.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(nigeria.urban.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

purrr::map(nigeria.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==0])
  }) 
purrr::map(nigeria.rural.df.list, function(x) {summary((filter(x, year2020==1))$NO2_Concentration[(filter(x, year2020==1))$covid_lockdown==1])
  }) 

#OLS regression
nigeria.urban.model.list <- purrr::pmap(list(nigeria.urban.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(nigeria.urban.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(nigeria.urban.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Urban Nigeria Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 
nigeria.rural.model.list <- purrr::pmap(list(nigeria.rural.df.list), function(x) {lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=x) 
})
purrr::map(nigeria.rural.model.list, function(x) {summary(x)
  }) #Summaries for each index model.
sjPlot::tab_model(nigeria.rural.model.list, terms = c("year2020:covid_lockdown", "no_of_weeks:year2020:covid_lockdown"), title = "ITS: Rural Nigeria Nitrogen Dioxide Concentrations During Lockdown, Significance of Different Lockdown Policies", show.ci = FALSE, dv.labels = paste(index.title.list)) #Table of p values. 

#Plot
urban.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(nigeria.urban.df.list[[n]], ylim=5E-5, paste("Urban", country), stringencyindex.split.country.df[[21]]$lockdown.date[[n]], index.title.list[[n]], nigeria.urban.model.list[[n]])
  }
}
urban.plots <- purrr::pmap(list("Nigeria", 1:9), urban.plot.fxn)

rural.plot.fxn <- function(country, n) {
  function() {
  period_scatter_plot(nigeria.rural.df.list[[n]], ylim=5E-5, paste("Rural", country), stringencyindex.split.country.df[[21]]$lockdown.date[[n]], index.title.list[[n]], nigeria.rural.model.list[[n]])
  }
}
rural.plots <- purrr::pmap(list("Nigeria", 1:9), rural.plot.fxn)
plot.save.fxn("Nigeria")
plot.print.fxn()
```

```{r,fig.width = 6, fig.height = 4, eval = TRUE}
purrr::pmap(list(nigeria.urban.df.list, "urban Nigeria", index.title.list), res.fxn) #Residuals plots. 
purrr::pmap(list(nigeria.rural.df.list, "rural Nigeria", index.title.list), res.fxn)
```


### Tables for paper.
```{r, eval = TRUE}
poland.urban.results <- results.df.fxn(poland.urban.model.list, index.title.list, "Poland")
poland.rural.results <- results.df.fxn(poland.rural.model.list, index.title.list, "Poland")
slovakia.urban.results <- results.df.fxn(slovakia.urban.model.list, index.title.list, "Slovakia")
slovakia.rural.results <- results.df.fxn(slovakia.rural.model.list, index.title.list, "Slovakia")
czechia.urban.results <- results.df.fxn(czechia.urban.model.list, index.title.list, "Czechia")
czechia.rural.results <- results.df.fxn(czechia.rural.model.list, index.title.list, "Czechia")
skorea.urban.results <- results.df.fxn(southkorea.urban.model.list, index.title.list[c(1:4, 6:9)], "South Korea")
skorea.rural.results <- results.df.fxn(southkorea.rural.model.list, index.title.list[c(1:4, 6:9)], "South Korea")
germany.urban.results <- results.df.fxn(germany.urban.model.list, index.title.list[c(1:4, 6:9)], "Germany")
germany.rural.results <- results.df.fxn(germany.rural.model.list, index.title.list[c(1:4, 6:9)], "Germany")
japan.urban.results <- results.df.fxn(japan.urban.model.list, index.title.list[c(1:3, 6:9)], "Japan")
japan.rural.results <- results.df.fxn(japan.rural.model.list, index.title.list[c(1:3, 6:9)], "Japan")
panama.urban.results <- results.df.fxn(panama.urban.model.list, index.title.list, "Panama")
panama.rural.results <- results.df.fxn(panama.rural.model.list, index.title.list, "Panama")
guatemala.urban.results <- results.df.fxn(guatemala.urban.model.list, index.title.list, "Guatemala")
guatemala.rural.results <- results.df.fxn(guatemala.rural.model.list, index.title.list, "Guatemala")
brazil.urban.results <- results.df.fxn(brazil.urban.model.list, index.title.list, "Brazil")
brazil.rural.results <- results.df.fxn(brazil.rural.model.list, index.title.list, "Brazil")
iraq.urban.results <- results.df.fxn(iraq.urban.model.list, index.title.list, "Iraq")
iraq.rural.results <- results.df.fxn(iraq.rural.model.list, index.title.list, "Iraq")
egypt.urban.results <- results.df.fxn(egypt.urban.model.list, index.title.list, "Egypt")
egypt.rural.results <- results.df.fxn(egypt.rural.model.list, index.title.list, "Egypt")
syria.urban.results <- results.df.fxn(syria.urban.model.list, index.title.list, "Syria")
syria.rural.results <- results.df.fxn(syria.rural.model.list, index.title.list, "Syria")
india.urban.results <- results.df.fxn(india.urban.model.list, index.title.list, "India")
india.rural.results <- results.df.fxn(india.rural.model.list, index.title.list, "India")
pakistan.urban.results <- results.df.fxn(pakistan.urban.model.list, index.title.list, "Pakistan")
pakistan.rural.results <- results.df.fxn(pakistan.rural.model.list, index.title.list, "Pakistan")
bangladesh.urban.results <- results.df.fxn(bangladesh.urban.model.list, index.title.list, "Bangladesh")
bangladesh.rural.results <- results.df.fxn(bangladesh.rural.model.list, index.title.list, "Bangladesh")
china.urban.results <- results.df.fxn(china.urban.model.list, index.title.list, "China")
china.rural.results <- results.df.fxn(china.rural.model.list, index.title.list, "China")
nkorea.urban.results <- results.df.fxn(northkorea.urban.model.list, index.title.list[8], "North Korea")
nkorea.rural.results <- results.df.fxn(northkorea.rural.model.list, index.title.list[8], "North Korea")
malaysia.urban.results <- results.df.fxn(malaysia.urban.model.list, index.title.list[c(1:4, 6:9)], "Malaysia")
malaysia.rural.results <- results.df.fxn(malaysia.rural.model.list, index.title.list[c(1:4, 6:9)], "Malaysia")
southafrica.urban.results <- results.df.fxn(southafrica.urban.model.list, index.title.list, "South Africa")
southafrica.rural.results <- results.df.fxn(southafrica.rural.model.list, index.title.list, "South Africa")
congo.urban.results <- results.df.fxn(congo.urban.model.list, index.title.list, "Congo")
congo.rural.results <- results.df.fxn(congo.rural.model.list, index.title.list, "Congo")
nigeria.urban.results <- results.df.fxn(nigeria.urban.model.list, index.title.list, "Nigeria")
nigeria.rural.results <- results.df.fxn(nigeria.rural.model.list, index.title.list, "Nigeria")

urban.results.df <- gtools::smartbind(poland.urban.results, slovakia.urban.results, czechia.urban.results, skorea.urban.results, germany.urban.results, japan.urban.results, panama.urban.results, guatemala.urban.results, brazil.urban.results, iraq.urban.results, egypt.urban.results, syria.urban.results, india.urban.results, pakistan.urban.results, bangladesh.urban.results, china.urban.results, nkorea.urban.results, malaysia.urban.results, southafrica.urban.results, congo.urban.results, nigeria.urban.results)
urban.results.df <- rename(urban.results.df, `School Closures` = `school closures_p`, `Workplace Closures` = `workplace closures_p`, `Cancelled Public Events` = `cancelled public events_p`, `Restrictions on Gatherings` = `restrictions on gatherings_p`, `Public Transport Closures` = `public transport closures_p`, `Stay at Home Orders` = `stay at home orders_p`, `Internal Travel Restrictions` = `restrictions on internal travel_p`, `International Travel Restrictions` = `restrictions on international travel_p`, `Overall Lockdown Stringency Index` = `overall lockdown stringency index_p`)
urban.results.df[, 3:11] <- round(urban.results.df[, 3:11], digits = 3)

rural.results.df <- gtools::smartbind(poland.rural.results, slovakia.rural.results, czechia.rural.results, skorea.rural.results, germany.rural.results, japan.rural.results, panama.rural.results, guatemala.rural.results, brazil.rural.results, iraq.rural.results, egypt.rural.results, syria.rural.results, india.rural.results, pakistan.rural.results, bangladesh.rural.results, china.rural.results, nkorea.rural.results, malaysia.rural.results, southafrica.rural.results, congo.rural.results, nigeria.rural.results)
rural.results.df <- rename(rural.results.df, `School Closures` = `school closures_p`, `Workplace Closures` = `workplace closures_p`, `Cancelled Public Events` = `cancelled public events_p`, `Restrictions on Gatherings` = `restrictions on gatherings_p`, `Public Transport Closures` = `public transport closures_p`, `Stay at Home Orders` = `stay at home orders_p`, `Internal Travel Restrictions` = `restrictions on internal travel_p`, `International Travel Restrictions` = `restrictions on international travel_p`, `Overall Lockdown Stringency Index` = `overall lockdown stringency index_p`)
rural.results.df[, 3:11] <- round(rural.results.df[, 3:11], digits = 3)

table.fxn <- function(data) {
gt_tbl <- data %>% gt(rowname_col = "Location") 

gt_tbl.mod <- 
  gt_tbl %>%
  tab_header(
    title = md("**Urban Nitrogen Dioxide Concentrations During Lockdown**"),
    subtitle = "Significance of Varying Lockdown Measures on Ambient NO2") %>% 
  tab_row_group(
    label = md("**Sub-Saharan Africa**"), 
    rows = 37:42) %>%
  tab_row_group(
    label = md(paste("**Southeast Asia, East Asia,", "\nand Oceania**")), 
    rows = 31:36) %>%
  tab_row_group(
    label = md("**South Asia**"), 
    rows = 25:30) %>%
  tab_row_group(
    label = md(paste("**North Africa and", "\nthe Middle East**")), 
    rows = 19:24) %>%
  tab_row_group(
    label = md(paste("**Latin America", "\nand Caribbean**")), 
    rows = 13:18) %>%
  tab_row_group(
    label = md("**High-income**"), 
    rows = 7:12) %>%
  tab_row_group(
    label = md(paste("**Central Europe,", "\nEastern Europe,", "\nand Central Asia**")), 
    rows = 1:6) %>% 
  tab_spanner(
    label = md("*p* value"),
    columns = 3:11) %>% 
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_column_labels())


  gt_tbl.mod %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `School Closures`,
      rows = `School Closures` <= 0.05)) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Workplace Closures`,
      rows = `Workplace Closures` <= 0.05)) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Cancelled Public Events`,
      rows = `Cancelled Public Events` <= 0.05)) %>%   
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Restrictions on Gatherings`,
      rows = `Restrictions on Gatherings` <= 0.05)) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Public Transport Closures`,
      rows = `Public Transport Closures` <= 0.05)) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Stay at Home Orders`,
      rows = `Stay at Home Orders` <= 0.05)) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Internal Travel Restrictions`,
      rows = `Internal Travel Restrictions` <= 0.05)) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `International Travel Restrictions`,
      rows = `International Travel Restrictions` <= 0.05)) %>%   
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = `Overall Lockdown Stringency Index`,
      rows = `Overall Lockdown Stringency Index` <= 0.05)) %>%
  tab_source_note(
    source_note = md("**Bolded** *p* values signify *p*<.05")
  )
}
table.fxn(urban.results.df)
table.fxn(rural.results.df)
```


### DELETE LATER: old plots
### World
#### ITS Analysis: World urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
world.urban.NO2 <- NO2.df.filter.fxn("world", "urban", as.Date("2019-11-07"), as.Date("2020-04-17"))
#Scatter plot
scatter_gplot(world.urban.NO2, 10E-5, 12, "Urban World")
#Tabulate pollution before and after lockdown
summary(world.urban.NO2)
summary(world.urban.NO2$NO2_Concentration[world.urban.NO2$covid_lockdown==0])
summary(world.urban.NO2$NO2_Concentration[world.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.world.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=world.urban.NO2) 
summary(period.model.world.urban)
#Plot
period_scatter_plot(world.urban.NO2,ylim=10E-5, xlockdown=12,location="Urban World",date.start=as.Date("2018-11-07"), date.end=as.Date("2019-04-17"),model=period.model.world.urban) 
res.fxn(world.urban.NO2, "urban world")

#Rural
world.rural.NO2 <- NO2.df.filter.fxn("world", "rural", as.Date("2019-11-07"), as.Date("2020-04-17"))
#Scatter plot
scatter_gplot(world.rural.NO2, 10E-5, 12, "Rural World")
#Tabulate pollution before and after lockdown
summary(world.rural.NO2)
summary(world.rural.NO2$NO2_Concentration[world.rural.NO2$covid_lockdown==0])
summary(world.rural.NO2$NO2_Concentration[world.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.world.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=world.rural.NO2) 
summary(period.model.world.rural)
#Plot
period_scatter_plot(world.rural.NO2,ylim=10E-5, xlockdown=12,location="Rural World",date.start=as.Date("2018-11-07"), date.end=as.Date("2019-04-17"),model=period.model.world.rural)
res.fxn(world.rural.NO2, "rural world")
```


### Czechia
#### ITS Analysis: Czechia urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
czechia.urban.NO2 <- NO2.df.filter.fxn("czechia", "urban", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(czechia.urban.NO2, 10E-5, 12, "Urban Czechia")
#Tabulate pollution before and after lockdown
summary(czechia.urban.NO2)
summary(czechia.urban.NO2$NO2_Concentration[czechia.urban.NO2$covid_lockdown==0])
summary(czechia.urban.NO2$NO2_Concentration[czechia.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.czechia.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=czechia.urban.NO2) 
summary(period.model.czechia.urban)
#Plot
period_scatter_plot(czechia.urban.NO2,ylim=10E-5, xlockdown=12,location="Urban Czechia",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.czechia.urban) 

#Rural
czechia.rural.NO2 <- NO2.df.filter.fxn("czechia", "rural", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(czechia.rural.NO2, 10E-5, 12, "Rural Czechia")
#Tabulate pollution before and after lockdown
summary(czechia.rural.NO2)
summary(czechia.rural.NO2$NO2_Concentration[czechia.rural.NO2$covid_lockdown==0])
summary(czechia.rural.NO2$NO2_Concentration[czechia.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.czechia.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=czechia.rural.NO2) 
summary(period.model.czechia.rural)
#Plot
period_scatter_plot(czechia.rural.NO2,ylim=10E-5, xlockdown=12,location="Rural Czechia",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.czechia.rural)
```


### Slovenia
#### ITS Analysis: Slovenia urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
slovenia.urban.NO2 <- NO2.df.filter.fxn("slovenia", "urban", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(slovenia.urban.NO2, 6E-5, 12, "Urban Slovenia")
#Tabulate pollution before and after lockdown
summary(slovenia.urban.NO2)
summary(slovenia.urban.NO2$NO2_Concentration[slovenia.urban.NO2$covid_lockdown==0])
summary(slovenia.urban.NO2$NO2_Concentration[slovenia.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.slovenia.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=slovenia.urban.NO2) 
summary(period.model.slovenia.urban)
#Plot
period_scatter_plot(slovenia.urban.NO2,ylim=6E-5, xlockdown=12,location="Urban Slovenia",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.slovenia.urban)

#Rural
slovenia.rural.NO2 <- NO2.df.filter.fxn("slovenia", "rural", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(slovenia.rural.NO2, 6E-5, 12, "Rural Slovenia")
#Tabulate pollution before and after lockdown
summary(slovenia.rural.NO2)
summary(slovenia.rural.NO2$NO2_Concentration[slovenia.rural.NO2$covid_lockdown==0])
summary(slovenia.rural.NO2$NO2_Concentration[slovenia.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.slovenia.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=slovenia.rural.NO2) 
summary(period.model.slovenia.rural)
#Plot
period_scatter_plot(slovenia.rural.NO2,ylim=6E-5, xlockdown=12,location="Rural Slovenia",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.slovenia.rural)
```


### Sweden
#### ITS Analysis: Sweden urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
sweden.urban.NO2 <- NO2.df.filter.fxn("sweden", "urban", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(sweden.urban.NO2, 6E-5, 12, "Urban Sweden")
#Tabulate pollution before and after lockdown
summary(sweden.urban.NO2)
summary(sweden.urban.NO2$NO2_Concentration[sweden.urban.NO2$covid_lockdown==0])
summary(sweden.urban.NO2$NO2_Concentration[sweden.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.sweden.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=sweden.urban.NO2) 
summary(period.model.sweden.urban)
#Plot
period_scatter_plot(sweden.urban.NO2,ylim=6E-5, xlockdown=12,location="Urban Sweden",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.sweden.urban)

#Rural
sweden.rural.NO2 <- NO2.df.filter.fxn("sweden", "rural", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(sweden.rural.NO2, 6E-5, 12, "Rural Sweden")
#Tabulate pollution before and after lockdown
summary(sweden.rural.NO2)
summary(sweden.rural.NO2$NO2_Concentration[sweden.rural.NO2$covid_lockdown==0])
summary(sweden.rural.NO2$NO2_Concentration[sweden.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.sweden.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=sweden.rural.NO2) 
summary(period.model.sweden.rural)
#Plot
period_scatter_plot(sweden.rural.NO2,ylim=6E-5, xlockdown=12,location="Rural Sweden",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.sweden.rural)
```


### Uruguay
#### ITS Analysis: Uruguay urban and rural Dec-May
```{r, eval = FALSE, include = FALSE}
#Urban
uruguay.urban.NO2 <- NO2.df.filter.fxn("uruguay", "urban", as.Date("2019-12-19"), as.Date("2020-05-29"))
#Scatter plot
scatter_gplot(uruguay.urban.NO2, 3.5E-5, 12, "Urban Uruguay")
#Tabulate pollution before and after lockdown
summary(uruguay.urban.NO2)
summary(uruguay.urban.NO2$NO2_Concentration[uruguay.urban.NO2$covid_lockdown==0])
summary(uruguay.urban.NO2$NO2_Concentration[uruguay.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.uruguay.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=uruguay.urban.NO2) 
summary(period.model.uruguay.urban)
#Plot
period_scatter_plot(uruguay.urban.NO2,ylim=3.5E-5, xlockdown=12,location="Urban Uruguay",date.start=as.Date("2018-12-19"), date.end=as.Date("2019-05-29"),model=period.model.uruguay.urban)

#Rural
uruguay.rural.NO2 <- NO2.df.filter.fxn("uruguay", "rural", as.Date("2019-12-19"), as.Date("2020-05-29"))
#Scatter plot
scatter_gplot(uruguay.rural.NO2, 3.5E-5, 12, "Rural Uruguay")
#Tabulate pollution before and after lockdown
summary(uruguay.rural.NO2)
summary(uruguay.rural.NO2$NO2_Concentration[uruguay.rural.NO2$covid_lockdown==0])
summary(uruguay.rural.NO2$NO2_Concentration[uruguay.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.uruguay.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=uruguay.rural.NO2) 
summary(period.model.uruguay.rural)
#Plot
period_scatter_plot(uruguay.rural.NO2,ylim=3.5E-5, xlockdown=12,location="Rural Uruguay",date.start=as.Date("2018-12-19"), date.end=as.Date("2019-05-29"),model=period.model.uruguay.rural)
```


### Lithuania
#### ITS Analysis: Lithuania urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
lithuania.urban.NO2 <- NO2.df.filter.fxn("lithuania", "urban", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(lithuania.urban.NO2, 5E-5, 12, "Urban Lithuania")
#Tabulate pollution before and after lockdown
summary(lithuania.urban.NO2)
summary(lithuania.urban.NO2$NO2_Concentration[lithuania.urban.NO2$covid_lockdown==0])
summary(lithuania.urban.NO2$NO2_Concentration[lithuania.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.lithuania.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=lithuania.urban.NO2) 
summary(period.model.lithuania.urban)
#Plot
period_scatter_plot(lithuania.urban.NO2,ylim=5E-5, xlockdown=12,location="Urban Lithuania",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.lithuania.urban)

#Rural
lithuania.rural.NO2 <- NO2.df.filter.fxn("lithuania", "rural", as.Date("2019-12-22"), as.Date("2020-06-01"))
#Scatter plot
scatter_gplot(lithuania.rural.NO2, 5E-5, 12, "Rural Lithuania")
#Tabulate pollution before and after lockdown
summary(lithuania.rural.NO2)
summary(lithuania.rural.NO2$NO2_Concentration[lithuania.rural.NO2$covid_lockdown==0])
summary(lithuania.rural.NO2$NO2_Concentration[lithuania.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.lithuania.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=lithuania.rural.NO2) 
summary(period.model.lithuania.rural)
#Plot
period_scatter_plot(lithuania.rural.NO2,ylim=5E-5, xlockdown=12,location="Rural Lithuania",date.start=as.Date("2018-12-22"), date.end=as.Date("2019-06-01"),model=period.model.lithuania.rural)
```


### U.S.
#### ITS analysis: U.S. urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
us.urban.NO2 <- NO2.df.filter.fxn("mod.us", "urban", as.Date("2019-12-25"), as.Date("2020-06-04"))
#Scatter plot
scatter_gplot(us.urban.NO2, 5E-5, 12, "Urban U.S.")
#Tabulate pollution before and after lockdown
summary(us.urban.NO2)
summary(us.urban.NO2$NO2_Concentration[us.urban.NO2$covid_lockdown==0])
summary(us.urban.NO2$NO2_Concentration[us.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.us.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=us.urban.NO2) 
summary(period.model.us.urban)
#Plot
period_scatter_plot(us.urban.NO2,ylim=5E-5, xlockdown=12,location="Urban U.S.",date.start=as.Date("2018-12-25"), date.end=as.Date("2019-06-04"),model=period.model.us.urban)
res.fxn(us.urban.NO2, "urban United States")

#Rural
us.rural.NO2 <- NO2.df.filter.fxn("us", "rural", as.Date("2019-12-25"), as.Date("2020-06-04"))
#Scatter plot
scatter_gplot(us.rural.NO2, 5E-5, 12, "Rural U.S.")
#Tabulate pollution before and after lockdown
summary(us.rural.NO2)
summary(us.rural.NO2$NO2_Concentration[us.rural.NO2$covid_lockdown==0])
summary(us.rural.NO2$NO2_Concentration[us.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.us.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=us.rural.NO2) 
summary(period.model.us.rural)
#Plot
period_scatter_plot(us.rural.NO2,ylim=5E-5, xlockdown=12,location="Rural U.S.",date.start=as.Date("2018-12-25"), date.end=as.Date("2019-06-04"),model=period.model.us.rural)
res.fxn(us.rural.NO2, "rural United States")
```


### Netherlands
#### ITS Analysis: Netherlands urban and rural Dec-May
```{r, eval = FALSE, include = FALSE}
#Urban
netherlands.urban.NO2 <- NO2.df.filter.fxn("netherlands", "urban", as.Date("2019-12-21"), as.Date("2020-05-31"))
#Scatter plot
scatter_gplot(netherlands.urban.NO2, 1.5E-4, 12, "Urban Netherlands")
#Tabulate pollution before and after lockdown
summary(netherlands.urban.NO2)
summary(netherlands.urban.NO2$NO2_Concentration[netherlands.urban.NO2$covid_lockdown==0])
summary(netherlands.urban.NO2$NO2_Concentration[netherlands.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.netherlands.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=netherlands.urban.NO2) 
summary(period.model.netherlands.urban)
#Plot
period_scatter_plot(netherlands.urban.NO2,ylim=1.5E-4, xlockdown=12,location="Urban Netherlands",date.start=as.Date("2018-12-21"), date.end=as.Date("2019-05-31"),model=period.model.netherlands.urban)

#Rural
netherlands.rural.NO2 <- NO2.df.filter.fxn("netherlands", "rural", as.Date("2019-12-21"), as.Date("2020-05-31"))
#Scatter plot
scatter_gplot(netherlands.rural.NO2, 1.5E-4, 12, "Rural Netherlands")
#Tabulate pollution before and after lockdown
summary(netherlands.rural.NO2)
summary(netherlands.rural.NO2$NO2_Concentration[netherlands.rural.NO2$covid_lockdown==0])
summary(netherlands.rural.NO2$NO2_Concentration[netherlands.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.netherlands.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=netherlands.rural.NO2) 
summary(period.model.netherlands.rural)
max(netherlands.urban.NO2$NO2_Concentration)
#Plot
period_scatter_plot(netherlands.rural.NO2,ylim=1.5E-4, xlockdown=12,location="Rural Netherlands",date.start=as.Date("2018-12-21"), date.end=as.Date("2019-05-31"),model=period.model.netherlands.rural)
```


### Estonia
#### ITS Analysis: Estonia urban and rural Dec-May
```{r, eval = FALSE, include = FALSE}
#Urban
estonia.urban.NO2 <- NO2.df.filter.fxn("estonia", "urban", as.Date("2019-12-19"), as.Date("2020-05-29"))
#Scatter plot
scatter_gplot(estonia.urban.NO2, 5E-5, 12, "Urban Estonia")
#Tabulate pollution before and after lockdown
summary(estonia.urban.NO2)
summary(estonia.urban.NO2$NO2_Concentration[estonia.urban.NO2$covid_lockdown==0])
summary(estonia.urban.NO2$NO2_Concentration[estonia.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.estonia.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=estonia.urban.NO2) 
summary(period.model.estonia.urban)
#Plot
period_scatter_plot(estonia.urban.NO2,ylim=5E-5, xlockdown=12,location="Urban Estonia",date.start=as.Date("2018-12-19"), date.end=as.Date("2019-05-29"),model=period.model.estonia.urban)

#Rural
estonia.rural.NO2 <- NO2.df.filter.fxn("estonia", "rural", as.Date("2019-12-19"), as.Date("2020-05-29"))
#Scatter plot
scatter_gplot(estonia.rural.NO2, 5E-5, 12, "Rural Estonia")
#Tabulate pollution before and after lockdown
summary(estonia.rural.NO2)
summary(estonia.rural.NO2$NO2_Concentration[estonia.rural.NO2$covid_lockdown==0])
summary(estonia.rural.NO2$NO2_Concentration[estonia.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.estonia.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=estonia.rural.NO2) 
summary(period.model.estonia.rural)
#Plot
period_scatter_plot(estonia.rural.NO2,ylim=5E-5, xlockdown=12,location="Rural Estonia",date.start=as.Date("2018-12-19"), date.end=as.Date("2019-05-29"),model=period.model.estonia.rural)
```


### Argentina
#### ITS Analysis: Argentina urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
argentina.urban.NO2 <- NO2.df.filter.fxn("argentina", "urban", as.Date("2019-12-26"), as.Date("2020-06-05"))
#Scatter plot
scatter_gplot(argentina.urban.NO2, 2.5E-5, 12, "Urban Argentina")
#Tabulate pollution before and after lockdown
summary(argentina.urban.NO2)
summary(argentina.urban.NO2$NO2_Concentration[argentina.urban.NO2$covid_lockdown==0])
summary(argentina.urban.NO2$NO2_Concentration[argentina.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.argentina.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=argentina.urban.NO2) 
summary(period.model.argentina.urban)
#Plot
period_scatter_plot(argentina.urban.NO2,ylim=2.5E-5, xlockdown=12,location="Urban Argentina",date.start=as.Date("2018-12-26"), date.end=as.Date("2019-06-05"),model=period.model.argentina.urban)

#Rural
argentina.rural.NO2 <- NO2.df.filter.fxn("argentina", "rural", as.Date("2019-12-26"), as.Date("2020-06-05"))
#Scatter plot
scatter_gplot(argentina.rural.NO2, 2.5E-5, 12, "Rural Argentina")
#Tabulate pollution before and after lockdown
summary(argentina.rural.NO2)
summary(argentina.rural.NO2$NO2_Concentration[argentina.rural.NO2$covid_lockdown==0])
summary(argentina.rural.NO2$NO2_Concentration[argentina.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.argentina.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=argentina.rural.NO2) 
summary(period.model.argentina.rural)
#Plot
period_scatter_plot(argentina.rural.NO2,ylim=2.5E-5, xlockdown=12,location="Rural Argentina",date.start=as.Date("2018-12-26"), date.end=as.Date("2019-06-05"),model=period.model.argentina.rural)
```


### Israel
#### ITS Analysis: Israel urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
israel.urban.NO2 <- NO2.df.filter.fxn("israel", "urban", as.Date("2019-12-25"), as.Date("2020-06-04"))
#Scatter plot
scatter_gplot(israel.urban.NO2, 5E-5, 12, "Urban Israel")
#Tabulate pollution before and after lockdown
summary(israel.urban.NO2)
summary(israel.urban.NO2$NO2_Concentration[israel.urban.NO2$covid_lockdown==0])
summary(israel.urban.NO2$NO2_Concentration[israel.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.israel.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=israel.urban.NO2) 
summary(period.model.israel.urban)
#Plot
period_scatter_plot(israel.urban.NO2,ylim=5E-5, xlockdown=12,location="Urban Israel",date.start=as.Date("2018-12-25"), date.end=as.Date("2019-06-04"),model=period.model.israel.urban)

#Rural
israel.rural.NO2 <- NO2.df.filter.fxn("israel", "rural", as.Date("2019-12-25"), as.Date("2020-06-04"))
#Scatter plot
scatter_gplot(israel.rural.NO2, 5E-5, 12, "Rural Israel")
#Tabulate pollution before and after lockdown
summary(israel.rural.NO2)
summary(israel.rural.NO2$NO2_Concentration[israel.rural.NO2$covid_lockdown==0])
summary(israel.rural.NO2$NO2_Concentration[israel.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.israel.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=israel.rural.NO2) 
summary(period.model.israel.rural)
#Plot
period_scatter_plot(israel.rural.NO2,ylim=5E-5, xlockdown=12,location="Rural Israel",date.start=as.Date("2018-12-25"), date.end=as.Date("2019-06-04"),model=period.model.israel.rural)
```


### China
#### ITS Analysis: China urban and rural Oct-April
```{r, eval = FALSE, include = FALSE}
#Urban
china.urban.NO2 <- NO2.df.filter.fxn("mod.china", "urban", as.Date("2019-10-31"), as.Date("2020-04-10"))
#Scatter plot
scatter_gplot(china.urban.NO2, 2.5E-4, 12, "Urban China")
#Tabulate pollution before and after lockdown
summary(china.urban.NO2)
summary(china.urban.NO2$NO2_Concentration[china.urban.NO2$covid_lockdown==0])
summary(china.urban.NO2$NO2_Concentration[china.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.china.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=china.urban.NO2) 
summary(period.model.china.urban)
#Plot
period_scatter_plot(china.urban.NO2,ylim=2.5E-4, xlockdown=12,location="Urban China",date.start=as.Date("2018-10-31"),date.end=as.Date("2019-04-10"),model=period.model.china.urban)
res.fxn(china.urban.NO2, "urban China")

#Rural
china.rural.NO2 <- NO2.df.filter.fxn("mod.china", "rural", as.Date("2019-10-31"), as.Date("2020-04-10"))
#Scatter plot
scatter_gplot(china.rural.NO2, 2.5E-4, 12, "Rural China")
#Tabulate pollution before and after lockdown
summary(china.rural.NO2)
summary(china.rural.NO2$NO2_Concentration[china.rural.NO2$covid_lockdown==0])
summary(china.rural.NO2$NO2_Concentration[china.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.china.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=china.rural.NO2) 
summary(period.model.china.rural)
#Plot
period_scatter_plot(china.rural.NO2,ylim=2.5E-4, xlockdown=12,location="Rural China",date.start=as.Date("2018-10-31"),date.end=as.Date("2019-04-10"),model=period.model.china.rural)
res.fxn(china.rural.NO2, "rural China")
```


### Italy
#### ITS Analysis: Italy urban and rural Dec-May
```{r, eval = FALSE, include = FALSE}
#Urban
italy.urban.NO2 <- NO2.df.filter.fxn("italy", "urban", as.Date("2019-12-15"), as.Date("2020-05-25"))
#Scatter plot
scatter_gplot(italy.urban.NO2, 1E-4, 12, "Urban Italy")
#Tabulate pollution before and after lockdown
summary(italy.urban.NO2)
summary(italy.urban.NO2$NO2_Concentration[italy.urban.NO2$covid_lockdown==0])
summary(italy.urban.NO2$NO2_Concentration[italy.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.italy.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=italy.urban.NO2) 
summary(period.model.italy.urban)
#Plot
period_scatter_plot(italy.urban.NO2,ylim=1E-4, xlockdown=12,location="Urban Italy",date.start=as.Date("2018-12-15"),date.end=as.Date("2019-05-25"),model=period.model.italy.urban)

#Rural
italy.rural.NO2 <- NO2.df.filter.fxn("italy", "rural", as.Date("2019-12-15"), as.Date("2020-05-25"))
#Scatter plot
scatter_gplot(italy.rural.NO2, 1E-4, 12, "Rural Italy")
#Tabulate pollution before and after lockdown
summary(italy.rural.NO2)
summary(italy.rural.NO2$NO2_Concentration[italy.rural.NO2$covid_lockdown==0])
summary(italy.rural.NO2$NO2_Concentration[italy.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.italy.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=italy.rural.NO2) 
summary(period.model.italy.rural)
#Plot
period_scatter_plot(italy.rural.NO2,ylim=1E-4, xlockdown=12,location="Rural Italy",date.start=as.Date("2018-12-15"),date.end=as.Date("2019-05-25"),model=period.model.italy.rural)
```


### Iraq
#### ITS Analysis: Iraq urban and rural Jan-June
```{r, eval = FALSE, include = FALSE}
#Urban
iraq.urban.NO2 <- NO2.df.filter.fxn("iraq", "urban", as.Date("2020-01-10"), as.Date("2020-06-20"))
#Scatter plot
scatter_gplot(iraq.urban.NO2, 1E-4, 12, "Urban Iraq")
#Tabulate pollution before and after lockdown
summary(iraq.urban.NO2)
summary(iraq.urban.NO2$NO2_Concentration[iraq.urban.NO2$covid_lockdown==0])
summary(iraq.urban.NO2$NO2_Concentration[iraq.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.iraq.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=iraq.urban.NO2) 
summary(period.model.iraq.urban)
#Plot
period_scatter_plot(iraq.urban.NO2,ylim=1E-4, xlockdown=12,location="Urban Iraq",date.start=as.Date("2019-01-10"),date.end=as.Date("2019-06-20"),model=period.model.iraq.urban)

#Rural
iraq.rural.NO2 <- NO2.df.filter.fxn("iraq", "rural", as.Date("2020-01-10"), as.Date("2020-06-20"))
#Scatter plot
scatter_gplot(iraq.rural.NO2, 1E-4, 12, "Rural Iraq")
#Tabulate pollution before and after lockdown
summary(iraq.rural.NO2)
summary(iraq.rural.NO2$NO2_Concentration[iraq.rural.NO2$covid_lockdown==0])
summary(iraq.rural.NO2$NO2_Concentration[iraq.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.iraq.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=iraq.rural.NO2) 
summary(period.model.iraq.rural)
#Plot
period_scatter_plot(iraq.rural.NO2,ylim=1E-4, xlockdown=12,location="Rural Iraq",date.start=as.Date("2019-01-10"),date.end=as.Date("2019-06-20"),model=period.model.iraq.rural)
```


### India
#### ITS Analysis: India urban and rural Dec-June
```{r, eval = FALSE, include = FALSE}
#Urban
india.urban.NO2 <- NO2.df.filter.fxn("india", "urban", as.Date("2019-12-30"), as.Date("2020-06-09"))
#Scatter plot
scatter_gplot(india.urban.NO2, 6E-5, 12, "Urban India")
#Tabulate pollution before and after lockdown
summary(india.urban.NO2)
summary(india.urban.NO2$NO2_Concentration[india.urban.NO2$covid_lockdown==0])
summary(india.urban.NO2$NO2_Concentration[india.urban.NO2$covid_lockdown==1])
#OLS regression
period.model.india.urban <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=india.urban.NO2) 
summary(period.model.india.urban)
#Plot
period_scatter_plot(india.urban.NO2,ylim=6E-5, xlockdown=12,location="Urban India",date.start=as.Date("2018-12-30"),date.end=as.Date("2019-06-09"),model=period.model.india.urban)

#Rural
india.rural.NO2 <- NO2.df.filter.fxn("india", "rural", as.Date("2019-12-30"), as.Date("2020-06-09"))
#Scatter plot
scatter_gplot(india.rural.NO2, 6E-5, 12, "Rural India")
#Tabulate pollution before and after lockdown
summary(india.rural.NO2)
summary(india.rural.NO2$NO2_Concentration[india.rural.NO2$covid_lockdown==0])
summary(india.rural.NO2$NO2_Concentration[india.rural.NO2$covid_lockdown==1])
#OLS regression
period.model.india.rural <- lm(NO2_Concentration ~ no_of_weeks*year2020 + covid_lockdown*year2020 + no_of_weeks*covid_lockdown*year2020, data=india.rural.NO2) 
summary(period.model.india.rural)
#Plot
period_scatter_plot(india.rural.NO2,ylim=6E-5, xlockdown=12,location="Rural India",date.start=as.Date("2018-12-30"),date.end=as.Date("2019-06-09"),model=period.model.india.rural)
```
